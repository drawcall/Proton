/*!
* Proton v7.2.0
* https://github.com/drawcall/Proton
*
* Copyright 2013-2025, drawcall
* Licensed under the MIT license
* http://www.opensource.org/licenses/mit-license
*
*/
this.Proton=function(){"use strict";function t(t,e,i,r,n,a,s){try{var o=t[a](s),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(r,n)}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}function r(){r=function(){return e};var t,e={},i=Object.prototype,n=i.hasOwnProperty,a=Object.defineProperty||function(t,e,i){t[e]=i.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",h=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function c(t,e,i,r){var n=e&&e.prototype instanceof v?e:v,s=Object.create(n.prototype),o=new k(r||[]);return a(s,"_invoke",{value:R(t,i,o)}),s}function d(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var p="suspendedStart",f="suspendedYield",m="executing",y="completed",g={};function v(){}function b(){}function _(){}var x={};l(x,o,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(B([])));E&&E!==i&&n.call(E,o)&&(x=E);var P=_.prototype=v.prototype=Object.create(x);function A(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function i(r,a,s,o){var h=d(t[r],t,a);if("throw"!==h.type){var u=h.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){i("next",t,s,o)}),(function(t){i("throw",t,s,o)})):e.resolve(l).then((function(t){u.value=t,s(u)}),(function(t){return i("throw",t,s,o)}))}o(h.arg)}var r;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,r){i(t,n,e,r)}))}return r=r?r.then(a,a):a()}})}function R(e,i,r){var n=p;return function(a,s){if(n===m)throw Error("Generator is already running");if(n===y){if("throw"===a)throw s;return{value:t,done:!0}}for(r.method=a,r.arg=s;;){var o=r.delegate;if(o){var h=C(o,r);if(h){if(h===g)continue;return h}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=m;var u=d(e,i,r);if("normal"===u.type){if(n=r.done?y:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=y,r.method="throw",r.arg=u.arg)}}}function C(e,i){var r=i.method,n=e.iterator[r];if(n===t)return i.delegate=null,"throw"===r&&e.iterator.return&&(i.method="return",i.arg=t,C(e,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=d(n,e.iterator,i.arg);if("throw"===a.type)return i.method="throw",i.arg=a.arg,i.delegate=null,g;var s=a.arg;return s?s.done?(i[e.resultName]=s.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,g):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function B(e){if(e||""===e){var i=e[o];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function i(){for(;++r<e.length;)if(n.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=t,i.done=!0,i};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:b,configurable:!0}),b.displayName=l(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,u,"GeneratorFunction")),t.prototype=Object.create(P),t},e.awrap=function(t){return{__await:t}},A(T.prototype),l(T.prototype,h,(function(){return this})),e.AsyncIterator=T,e.async=function(t,i,r,n,a){void 0===a&&(a=Promise);var s=new T(c(t,i,r,n),a);return e.isGeneratorFunction(i)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},A(P),l(P,u,"Generator"),l(P,o,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var r in e)i.push(r);return i.reverse(),function t(){for(;i.length;){var r=i.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(r,n){return o.type="throw",o.arg=e,i.next=r,n&&(i.method="next",i.arg=t),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var h=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(h&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(h){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=t,s.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),S(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;S(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,i,r){return this.delegate={iterator:B(e),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function a(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var s=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},o=function(t,e){return[1,0,0,0,1,0,t,e,1]},h=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},u=function(t,e){return[t,0,0,0,e,0,0,0,1]},l=function(t,e){var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],u=t[7],l=t[8],c=e[0],d=e[1],p=e[2],f=e[3],m=e[4],y=e[5],g=e[6],v=e[7],b=e[8];return[i*c+r*f+n*g,i*d+r*m+n*v,i*p+r*y+n*b,a*c+s*f+o*g,a*d+s*m+o*v,a*p+s*y+o*b,h*c+u*f+l*g,h*d+u*m+l*v,h*p+u*y+l*b]},c={createCanvas:function(t,e,i,r){void 0===r&&(r="absolute");var n=document.createElement("canvas");return n.id=t,n.width=e,n.height=i,n.style.opacity=0,n.style.position=r,this.transform(n,-500,-500,0,0),n},createDiv:function(t,e,i){var r=document.createElement("div");return r.id=t,r.style.position="absolute",this.resize(r,e,i),r},resize:function(t,e,i){t.style.width=e+"px",t.style.height=i+"px",t.style.marginLeft=-e/2+"px",t.style.marginTop=-i/2+"px"},transform:function(t,e,i,r,n){t.style.willChange="transform";var a="translate("+e+"px, "+i+"px) scale("+r+") rotate("+n+"deg)";this.css3(t,"transform",a)},transform3d:function(t,e,i,r,n){t.style.willChange="transform";var a="translate3d("+e+"px, "+i+"px, 0) scale("+r+") rotate("+n+"deg)";this.css3(t,"backfaceVisibility","hidden"),this.css3(t,"transform",a)},css3:function(t,e,i){var r=e.charAt(0).toUpperCase()+e.substr(1);t.style["Webkit"+r]=i,t.style["Moz"+r]=i,t.style["O"+r]=i,t.style["ms"+r]=i,t.style[""+e]=i}},d={},p={},f=0,m=function(t,e,i){t.drawImage(e,i.x,i.y);var r=t.getImageData(i.x,i.y,i.width,i.height);return t.clearRect(i.x,i.y,i.width,i.height),r},y=function(t,e,i){var r="string"==typeof t?t:t.src;if(d[r])e(d[r],i);else{var n=new Image;n.onload=function(t){d[r]=t.target,e(d[r],i)},n.src=r}},g=function(t,e,i){var r=t.src;if(!p[r]){var n=s(t.width),a=s(t.height),o=c.createCanvas("proton_canvas_cache_"+ ++f,n,a);o.getContext("2d").drawImage(t,0,0,t.width,t.height),p[r]=o}return e&&e(p[r],i),p[r]},v={initValue:function(t,e){return t=null!=t?t:e},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyArray:function(t){t&&(t.length=0)},toArray:function(t){return this.isArray(t)?t:[t]},sliceArray:function(t,e,i){this.emptyArray(i);for(var r=e;r<t.length;r++)i.push(t[r])},getRandFromArray:function(t){return t?t[Math.floor(t.length*Math.random())]:null},emptyObject:function(t,e){for(var i in void 0===e&&(e=null),t)e&&e.indexOf(i)>-1||delete t[i]},classApply:function(t,e){return void 0===e&&(e=null),e?new(t.bind.apply(t,[null].concat(e))):new t},getImageData:function(t,e,i){return m(t,e,i)},destroyAll:function(t,e){void 0===e&&(e=null);for(var i=t.length;i--;){try{t[i].destroy(e)}catch(t){}delete t[i]}t.length=0},assign:function(t,e){if("function"!=typeof Object.assign){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}return Object.assign(t,e)}},b={},_={_index:0,_cache:{},id:function(t){return void 0!==b[t]&&null!==b[t]||(b[t]=0),t+"_"+b[t]++},getId:function(t){var e=this.getIdFromCache(t);return e||(e="PUID_"+this._index++,this._cache[e]=t,e)},getIdFromCache:function(t){var e,i;for(i in this._cache){if((e=this._cache[i])===t)return i;if(this.isBody(e,t)&&e.src===t.src)return i}return null},isBody:function(t,e){return"object"==typeof t&&"object"==typeof e&&t.isInner&&e.isInner},getTarget:function(t){return this._cache[t]}},x=function(){function t(t){this.total=0,this.cache={}}var e=t.prototype;return e.get=function(t,e,i){var r;return i=i||t.__puid||_.getId(t),(r=this.cache[i]&&this.cache[i].length>0?this.cache[i].pop():this.createOrClone(t,e)).__puid=t.__puid||i,r},e.expire=function(t){return this.getCache(t.__puid).push(t)},e.createOrClone=function(t,e){return this.total++,this.create?this.create(t,e):"function"==typeof t?v.classApply(t,e):t.clone()},e.getCount=function(){var t=0;for(var e in this.cache)t+=this.cache[e].length;return t++},e.destroy=function(){for(var t in this.cache)this.cache[t].length=0,delete this.cache[t]},e.getCache=function(t){return void 0===t&&(t="default"),this.cache[t]||(this.cache[t]=[]),this.cache[t]},t}(),w=function(){function t(t){this.proton=t,this.container=null,this.type=1,this.emitterIndex=0,this.rendererIndex=0}var e=t.prototype;return e.update=function(t,e){this.add(t,e);var i=this.getEmitter(),r=this.getRenderer(),n="";switch(this.type){case 2:n+="emitter:"+this.proton.emitters.length+"<br>",i&&(n+="em speed:"+i.emitSpeed+"<br>"),i&&(n+="pos:"+this.getEmitterPos(i));break;case 3:i&&(n+="initializes:"+i.initializes.length+"<br>"),i&&(n+='<span style="display:inline-block;">'+this.concatArr(i.initializes)+"</span><br>"),i&&(n+="behaviours:"+i.behaviours.length+"<br>"),i&&(n+='<span style="display:inline-block;">'+this.concatArr(i.behaviours)+"</span><br>");break;case 4:r&&(n+=r.name+"<br>"),r&&(n+="body:"+this.getCreatedNumber(r)+"<br>");break;default:n+="particles:"+this.proton.getCount()+"<br>",n+="pool:"+this.proton.pool.getCount()+"<br>",n+="total:"+this.proton.pool.total}this.container.innerHTML=n},e.add=function(t,e){var i=this;if(!this.container){var r,n;switch(this.type=1,this.container=document.createElement("div"),this.container.style.cssText=["position:absolute;bottom:0px;left:0;cursor:pointer;","opacity:0.9;z-index:10000;padding:10px;font-size:12px;font-family:Helvetica,Arial,sans-serif;","width:120px;height:50px;background-color:#002;color:#0ff;"].join(""),this.container.addEventListener("click",(function(t){i.type++,i.type>4&&(i.type=1)}),!1),t){case 2:r="#201",n="#f08";break;case 3:r="#020",n="#0f0";break;default:r="#002",n="#0ff"}this.container.style["background-color"]=r,this.container.style.color=n}this.container.parentNode||(e=e||this.body||document.body).appendChild(this.container)},e.getEmitter=function(){return this.proton.emitters[this.emitterIndex]},e.getRenderer=function(){return this.proton.renderers[this.rendererIndex]},e.concatArr=function(t){var e="";if(!t||!t.length)return e;for(var i=0;i<t.length;i++)e+=(t[i].name||"").substr(0,1)+".";return e},e.getCreatedNumber=function(t){return t.pool.total||t.cpool&&t.cpool.total||0},e.getEmitterPos=function(t){return Math.round(t.p.x)+","+Math.round(t.p.y)},e.destroy=function(){this.container&&this.container.parentNode&&(this.body||document.body).removeChild(this.container);this.proton=null,this.container=null},t}(),E=function(){function t(){this._listeners=null}t.bind=function(e){e.prototype.dispatchEvent=t.prototype.dispatchEvent,e.prototype.hasEventListener=t.prototype.hasEventListener,e.prototype.addEventListener=t.prototype.addEventListener,e.prototype.removeEventListener=t.prototype.removeEventListener,e.prototype.removeAllEventListeners=t.prototype.removeAllEventListeners};var e=t.prototype;return e.addEventListener=function(t,e){return this._listeners?this.removeEventListener(t,e):this._listeners={},this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),e},e.removeEventListener=function(t,e){if(this._listeners&&this._listeners[t])for(var i=this._listeners[t],r=i.length,n=0;n<r;n++)if(i[n]===e){1===r?delete this._listeners[t]:i.splice(n,1);break}},e.removeAllEventListeners=function(t){t?this._listeners&&delete this._listeners[t]:this._listeners=null},e.dispatchEvent=function(t,e){var i=!1,r=this._listeners;if(t&&r){var n,a=r[t];if(!a)return i;for(var s=a.length;s--;)n=a[s],i=i||n(e)}return!!i},e.hasEventListener=function(t){var e=this._listeners;return!(!e||!e[t])},t}(),P=3.1415926,A=1/0,T={PI:P,PIx2:2*P,PI_2:P/2,PI_180:P/180,N180_PI:180/P,Infinity:-999,isInfinity:function(t){return t===this.Infinity||t===A},randomAToB:function(t,e,i){return void 0===i&&(i=!1),i?(Math.random()*(e-t)|0)+t:t+Math.random()*(e-t)},randomFloating:function(t,e,i){return this.randomAToB(t-e,t+e,i)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()|0).toString(16)).slice(-6)},randomZone:function(t){},floor:function(t,e){void 0===e&&(e=4);var i=Math.pow(10,e);return Math.floor(t*i)/i},degreeTransform:function(t){return t*P/180},toColor16:function(t){return"#"+t.toString(16)}},R=function(){function t(t){this.type=t}var e=t.prototype;return e.calculate=function(t,e,i){this.eulerIntegrate(t,e,i)},e.eulerIntegrate=function(t,e,i){t.sleep||(t.old.p.copy(t.p),t.old.v.copy(t.v),t.a.multiplyScalar(1/t.mass),t.v.add(t.a.multiplyScalar(e)),t.p.add(t.old.v.multiplyScalar(e)),i&&t.v.multiplyScalar(i),t.a.clear())},t}(),C=function(){function t(e){this.emitters=[],this.renderers=[],this.time=0,this.now=0,this.then=0,this.elapsed=0,this.stats=new w(this),this.pool=new x(80),this.integrationType=v.initValue(e,t.EULER),this.integrator=new R(this.integrationType),this._fps="auto",this._interval=t.DEFAULT_INTERVAL}var i,r,n,a=t.prototype;return a.addRenderer=function(t){t.init(this),this.renderers.push(t)},a.removeRenderer=function(t){var e=this.renderers.indexOf(t);this.renderers.splice(e,1),t.remove(this)},a.addEmitter=function(e){this.emitters.push(e),e.parent=this,this.dispatchEvent(t.EMITTER_ADDED,e)},a.removeEmitter=function(e){var i=this.emitters.indexOf(e);this.emitters.splice(i,1),e.parent=null,this.dispatchEvent(t.EMITTER_REMOVED,e)},a.update=function(){"auto"===this._fps?(this.dispatchEvent(t.PROTON_UPDATE),t.USE_CLOCK?(this.then||(this.then=(new Date).getTime()),this.now=(new Date).getTime(),this.elapsed=.001*(this.now-this.then),this.amendChangeTabsBug(),this.elapsed>0&&this.emittersUpdate(this.elapsed),this.then=this.now):this.emittersUpdate(t.DEFAULT_INTERVAL),this.dispatchEvent(t.PROTON_UPDATE_AFTER)):(this.then||(this.then=(new Date).getTime()),this.now=(new Date).getTime(),this.elapsed=.001*(this.now-this.then),this.elapsed>this._interval&&(this.dispatchEvent(t.PROTON_UPDATE),this.emittersUpdate(this._interval),this.then=this.now-this.elapsed%this._interval*1e3,this.dispatchEvent(t.PROTON_UPDATE_AFTER)))},a.emittersUpdate=function(t){for(var e=this.emitters.length;e--;)this.emitters[e].update(t)},a.amendChangeTabsBug=function(){t.amendChangeTabsBug&&this.elapsed>.5&&(this.then=(new Date).getTime(),this.elapsed=0)},a.getCount=function(){for(var t=0,e=this.emitters.length;e--;)t+=this.emitters[e].particles.length;return t},a.getAllParticles=function(){for(var t=[],e=this.emitters.length;e--;)t=t.concat(this.emitters[e].particles);return t},a.destroyAllEmitters=function(){v.destroyAll(this.emitters)},a.destroy=function(t){var e=this;void 0===t&&(t=!1);var i=function(){e.time=0,e.then=0,e.pool.destroy(),e.stats.destroy(),v.destroyAll(e.emitters),v.destroyAll(e.renderers,e.getAllParticles()),e.integrator=null,e.renderers=null,e.emitters=null,e.stats=null,e.pool=null};t?setTimeout(i,200):i()},i=t,(r=[{key:"fps",get:function(){return this._fps},set:function(e){this._fps=e,this._interval="auto"===e?t.DEFAULT_INTERVAL:T.floor(1/e,7)}}])&&e(i.prototype,r),n&&e(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i}();C.USE_CLOCK=!1,C.MEASURE=100,C.EULER="euler",C.RK2="runge-kutta2",C.PARTICLE_CREATED="PARTICLE_CREATED",C.PARTICLE_UPDATE="PARTICLE_UPDATE",C.PARTICLE_SLEEP="PARTICLE_SLEEP",C.PARTICLE_DEAD="PARTICLE_DEAD",C.EMITTER_ADDED="EMITTER_ADDED",C.EMITTER_REMOVED="EMITTER_REMOVED",C.PROTON_UPDATE="PROTON_UPDATE",C.PROTON_UPDATE_AFTER="PROTON_UPDATE_AFTER",C.DEFAULT_INTERVAL=.0167,C.amendChangeTabsBug=!0,E.bind(C);var I=function(){function t(t,e,i){void 0===t&&(t=255),void 0===e&&(e=255),void 0===i&&(i=255),this.r=t,this.g=e,this.b=i}return t.prototype.reset=function(){this.r=255,this.g=255,this.b=255},t}(),S=function(){function t(t,e,i){this.isArray=void 0,this.a=void 0,this.b=void 0,this.center=void 0,v.isArray(t)?(this.isArray=!0,this.a=t):(this.isArray=!1,this.a=v.initValue(t,1),this.b=v.initValue(e,this.a),this.center=v.initValue(i,!1))}return t.prototype.getValue=function(t){return void 0===t&&(t=!1),this.isArray?v.getRandFromArray(this.a):this.center?T.randomFloating(this.a,this.b,t):T.randomAToB(this.a,this.b,t)},t.setSpanValue=function(e,i,r){return e instanceof t?e:void 0===i?new t(e):void 0===r?new t(e,i):new t(e,i,r)},t.getSpanValue=function(e){return e instanceof t?e.getValue():e},t}(),k={hasProp:function(t,e){return!!t&&void 0!==t[e]},setProp:function(t,e){for(var i in e)t.hasOwnProperty(i)&&(t[i]=S.getSpanValue(e[i]));return t},setVectorVal:function(t,e){void 0===e&&(e=null),e&&(this.hasProp(e,"x")&&(t.p.x=e.x),this.hasProp(e,"y")&&(t.p.y=e.y),this.hasProp(e,"vx")&&(t.v.x=e.vx),this.hasProp(e,"vy")&&(t.v.y=e.vy),this.hasProp(e,"ax")&&(t.a.x=e.ax),this.hasProp(e,"ay")&&(t.a.y=e.ay),this.hasProp(e,"p")&&t.p.copy(e.p),this.hasProp(e,"v")&&t.v.copy(e.v),this.hasProp(e,"a")&&t.a.copy(e.a),this.hasProp(e,"position")&&t.p.copy(e.position),this.hasProp(e,"velocity")&&t.v.copy(e.velocity),this.hasProp(e,"accelerate")&&t.a.copy(e.accelerate))}},B={easeLinear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeInSine:function(t){return 1-Math.cos(t*T.PI_2)},easeOutSine:function(t){return Math.sin(t*T.PI_2)},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},getEasing:function(t){return"function"==typeof t?t:this[t]||this.easeLinear}},M=function(){function t(t,e){this.x=void 0,this.y=void 0,this.x=t||0,this.y=e||0}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.setX=function(t){return this.x=t,this},e.setY=function(t){return this.y=t,this},e.getGradient=function(){return 0!==this.x?Math.atan2(this.y,this.x):this.y>0?T.PI_2:this.y<0?-T.PI_2:void 0},e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.add=function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},e.addXY=function(t,e){return this.x+=t,this.y+=e,this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},e.sub=function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},e.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.divideScalar=function(t){return 0!==t?(this.x/=t,this.y/=t):this.set(0,0),this},e.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.negate=function(){return this.multiplyScalar(-1)},e.dot=function(t){return this.x*t.x+this.y*t.y},e.lengthSq=function(){return this.x*this.x+this.y*this.y},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.normalize=function(){return this.divideScalar(this.length())},e.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},e.rotate=function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)+i*Math.sin(t),this.y=-e*Math.sin(t)+i*Math.cos(t),this},e.distanceToSquared=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},e.equals=function(t){return t.x===this.x&&t.y===this.y},e.clear=function(){return this.x=0,this.y=0,this},e.clone=function(){return new t(this.x,this.y)},t}(),U=function(){function t(t){this.id="",this.old=null,this.data=null,this.behaviours=null,this.p=null,this.v=null,this.a=null,this.rgb=null,this.name="Particle",this.id=_.id(this.name),this.old={},this.data={},this.behaviours=[],this.p=new M,this.v=new M,this.a=new M,this.old.p=new M,this.old.v=new M,this.old.a=new M,this.rgb=new I,this.reset(),t&&k.setProp(this,t)}var e=t.prototype;return e.getDirection=function(){return Math.atan2(this.v.x,-this.v.y)*T.N180_PI},e.reset=function(){return this.life=1/0,this.age=0,this.dead=!1,this.sleep=!1,this.body=null,this.sprite=null,this.parent=null,this.energy=1,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.easing=B.easeLinear,this.rgb.reset(),v.emptyObject(this.data),this.removeAllBehaviours(),this},e.update=function(t,e){if(this.sleep||(this.age+=t,this.applyBehaviours(t,e)),this.age<this.life){var i=this.easing(this.age/this.life);this.energy=Math.max(1-i,0)}else this.destroy()},e.applyBehaviours=function(t,e){var i,r=this.behaviours.length;for(i=0;i<r;i++)this.behaviours[i]&&this.behaviours[i].applyBehaviour(this,t,e)},e.addBehaviour=function(t){this.behaviours.push(t),t.hasOwnProperty("parents")&&t.parents.push(this),t.initialize(this)},e.addBehaviours=function(t){var e,i=t.length;for(e=0;e<i;e++)this.addBehaviour(t[e])},e.removeBehaviour=function(t){var e=this.behaviours.indexOf(t);e>-1&&(this.behaviours.splice(e,1).parents=null)},e.removeAllBehaviours=function(){v.emptyArray(this.behaviours)},e.destroy=function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null},t}(),V={hexToRgb:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t;return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}},rgbToHex:function(t){return"rgb("+t.r+", "+t.g+", "+t.b+")"},getHex16FromParticle:function(t){return 65536*Number(t.rgb.r)+256*Number(t.rgb.g)+Number(t.rgb.b)}},D=function(){function t(t,e){this.r=Math.abs(t)||0,this.tha=e||0}var e=t.prototype;return e.set=function(t,e){return this.r=t,this.tha=e,this},e.setR=function(t){return this.r=t,this},e.setTha=function(t){return this.tha=t,this},e.copy=function(t){return this.r=t.r,this.tha=t.tha,this},e.toVector=function(){return new M(this.getX(),this.getY())},e.getX=function(){return this.r*Math.sin(this.tha)},e.getY=function(){return-this.r*Math.cos(this.tha)},e.normalize=function(){return this.r=1,this},e.equals=function(t){return t.r===this.r&&t.tha===this.tha},e.clear=function(){return this.r=0,this.tha=0,this},e.clone=function(){return new t(this.r,this.tha)},t}(),L={create:function(t){var e=new Float32Array(9);return t&&this.set(t,e),e},set:function(t,e){for(var i=0;i<9;i++)e[i]=t[i];return e},multiply:function(t,e,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[6],u=t[7],l=e[0],c=e[1],d=e[2],p=e[3],f=e[4],m=e[6],y=e[7];return i[0]=l*r+c*s,i[1]=l*n+c*o,i[2]=a*d,i[3]=p*r+f*s,i[4]=p*n+f*o,i[6]=m*r+y*s+h,i[7]=m*n+y*o+u,i},inverse:function(t,e){var i,r=t[0],n=t[1],a=t[3],s=t[4],o=t[6],h=t[7],u=s,l=-a,c=h*a-s*o;return i=1/(r*u+n*l),e[0]=u*i,e[1]=-n*i,e[3]=l*i,e[4]=r*i,e[6]=c*i,e[7]=(-h*r+n*o)*i,e},multiplyVec2:function(t,e,i){var r=e[0],n=e[1];return i[0]=r*t[0]+n*t[3]+t[6],i[1]=r*t[1]+n*t[4]+t[7],i}},F=function(t){function e(e){var i;return(i=t.call(this)||this)._arr=v.toArray(e),i}return i(e,t),e.prototype.getValue=function(){var t=v.getRandFromArray(this._arr);return"random"===t||"Random"===t?T.randomColor():t},e.createArraySpan=function(t){return t?t instanceof e?t:new e(t):null},e}(S),z=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.bottom=this.y+this.height,this.right=this.x+this.width}return t.prototype.contains=function(t,e){return t<=this.right&&t>=this.x&&e<=this.bottom&&e>=this.y},t}(),O=function(){function t(t,e){this.numPan=void 0,this.timePan=void 0,this.startTime=void 0,this.nextTime=void 0,this.numPan=S.setSpanValue(v.initValue(t,1)),this.timePan=S.setSpanValue(v.initValue(e,1)),this.startTime=0,this.nextTime=0,this.init()}var e=t.prototype;return e.init=function(){this.startTime=0,this.nextTime=this.timePan.getValue()},e.getValue=function(t){return this.startTime+=t,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),1===this.numPan.b?this.numPan.getValue(!1)>.5?1:0:this.numPan.getValue(!0)):0},t}(),G=function(){function t(){}var e=t.prototype;return e.reset=function(){},e.init=function(t,e){e?this.initialize(e):this.initialize(t)},e.initialize=function(t){},t}(),N=function(t){function e(e,i,r){var n;return(n=t.call(this)||this).lifePan=void 0,n.name=void 0,n.lifePan=S.setSpanValue(e,i,r),n.name="Life",n}return i(e,t),e.prototype.initialize=function(t){this.lifePan.a===1/0?t.life=1/0:t.life=this.lifePan.getValue()},e}(G),H=function(){function t(){this.vector=new M(0,0),this.random=0,this.crossType="dead",this.alert=!0}var e=t.prototype;return e.getPosition=function(){},e.crossing=function(t){},e.destroy=function(){this.vector=null},t}(),q=function(t){function e(e,i){var r;return(r=t.call(this)||this).x=e,r.y=i,r}i(e,t);var r=e.prototype;return r.getPosition=function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector},r.crossing=function(t){this.alert&&(console.error("Sorry, PointZone does not support crossing method!"),this.alert=!1)},e}(H),j=function(t){function e(e){var i;return(i=t.call(this)||this).zone=void 0,i.name=void 0,i.zone=v.initValue(e,new q),i.name="Position",i}i(e,t);var r=e.prototype;return r.reset=function(t){this.zone=v.initValue(t,new q)},r.initialize=function(t){this.zone.getPosition(),t.p.x=this.zone.vector.x,t.p.y=this.zone.vector.y},e}(G),X=function(t){function e(e,i,r){var n;return(n=t.call(this)||this).rPan=void 0,n.thaPan=void 0,n.name=void 0,n.rPan=S.setSpanValue(e),n.thaPan=S.setSpanValue(i),n.type=v.initValue(r,"vector"),n.name="Velocity",n}i(e,t);var r=e.prototype;return r.reset=function(t,e,i){this.rPan=S.setSpanValue(t),this.thaPan=S.setSpanValue(e),this.type=v.initValue(i,"vector")},r.normalizeVelocity=function(t){return t*C.MEASURE},r.initialize=function(t){if("p"===this.type||"P"===this.type||"polar"===this.type){var e=new D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*T.PI_180);t.v.x=e.getX(),t.v.y=e.getY()}else t.v.x=this.normalizeVelocity(this.rPan.getValue()),t.v.y=this.normalizeVelocity(this.thaPan.getValue())},e}(G),W=function(t){function e(e,i,r){var n;return(n=t.call(this)||this).massPan=void 0,n.name=void 0,n.massPan=S.setSpanValue(e,i,r),n.name="Mass",n}return i(e,t),e.prototype.initialize=function(t){t.mass=this.massPan.getValue()},e}(G),Y=function(t){function e(e,i,r){var n;return(n=t.call(this)||this).radius=void 0,n.name=void 0,n.radius=S.setSpanValue(e,i,r),n.name="Radius",n}i(e,t);var r=e.prototype;return r.reset=function(t,e,i){this.radius=S.setSpanValue(t,e,i)},r.initialize=function(t){t.radius=this.radius.getValue(),t.data.oldRadius=t.radius},e}(G),Q=function(t){function e(e,i,r){var n;return(n=t.call(this)||this).image=void 0,n.name=void 0,n.image=n.setSpanValue(e),n.w=v.initValue(i,20),n.h=v.initValue(r,n.w),n.name="Body",n}i(e,t);var r=e.prototype;return r.initialize=function(t){var e=this.image.getValue();t.body="string"==typeof e?{width:this.w,height:this.h,src:e,isInner:!0,inner:!0}:e},r.setSpanValue=function(t){return t instanceof F?t:new F(t)},e}(G),Z=function(){function t(e,i){this.life=v.initValue(e,1/0),this.easing=B.getEasing(i),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.id="Behaviour_"+t.id++,this.name="Behaviour"}var e=t.prototype;return e.reset=function(t,e){this.life=v.initValue(t,1/0),this.easing=B.getEasing(e)},e.normalizeForce=function(t){return t.multiplyScalar(C.MEASURE)},e.normalizeValue=function(t){return t*C.MEASURE},e.initialize=function(t){},e.calculate=function(t,e,i){if(this.age+=e,this.age>=this.life||this.dead)this.energy=0,this.dead=!0,this.destroy();else{var r=this.easing(t.age/t.life);this.energy=Math.max(1-r,0)}},e.applyBehaviour=function(t,e,i){this.calculate(t,e,i)},e.destroy=function(){for(var t=this.parents.length;t--;)this.parents[t].removeBehaviour(this);this.parents.length=0},t}();Z.id=0;var K=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).force=a.normalizeForce(new M(e,i)),a.name="Force",a}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n){this.force=this.normalizeForce(new M(e,i)),r&&t.prototype.reset.call(this,r,n)},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),t.a.add(this.force)},e}(Z),J=function(t){function e(e,i,r,n,a){var s;return(s=t.call(this,n,a)||this).targetPosition=v.initValue(e,new M),s.radius=v.initValue(r,1e3),s.force=v.initValue(s.normalizeValue(i),100),s.radiusSq=s.radius*s.radius,s.attractionForce=new M,s.lengthSq=0,s.name="Attraction",s}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n,a){this.targetPosition=v.initValue(e,new M),this.radius=v.initValue(r,1e3),this.force=v.initValue(this.normalizeValue(i),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new M,this.lengthSq=0,n&&t.prototype.reset.call(this,n,a)},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(t.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-5&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),this.attractionForce.multiplyScalar(this.force),t.a.add(this.attractionForce))},e}(Z),$=function(t){function e(e,i,r,n,a){var s;return(s=t.call(this,n,a)||this).reset(e,i,r),s.time=0,s.name="RandomDrift",s}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n,a){this.panFoce=new M(e,i),this.panFoce=this.normalizeForce(this.panFoce),this.delay=r,n&&t.prototype.reset.call(this,n,a)},r.initialize=function(t){t.data.time=0},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),t.data.time+=e,t.data.time>=this.delay&&(t.a.addXY(T.randomAToB(-this.panFoce.x,this.panFoce.x),T.randomAToB(-this.panFoce.y,this.panFoce.y)),t.data.time=0)},e}(Z),tt=function(t){function e(e,i,r){var n;return(n=t.call(this,0,e,i,r)||this).name="Gravity",n}return i(e,t),e.prototype.reset=function(e,i,r){t.prototype.reset.call(this,0,e,i,r)},e}(K),et=function(t){function e(e,i,r,n,a){var s;return(s=t.call(this,n,a)||this).reset(e,i,r),s.newPool=[],s.pool=[],s.name="Collision",s}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n,a){this.emitter=v.initValue(e,null),this.mass=v.initValue(i,!0),this.callback=v.initValue(r,null),this.collisionPool=[],this.delta=new M,n&&t.prototype.reset.call(this,n,a)},r.applyBehaviour=function(t,e,i){this.emitter?v.sliceArray(this.emitter.particles,i,this.newPool):v.sliceArray(this.pool,i,this.newPool);var r,n,a,s,o,h,u,l=this.newPool.length;for(u=0;u<l;u++)if((r=this.newPool[u])!==t){this.delta.copy(r.p),this.delta.sub(t.p),n=this.delta.lengthSq();var c=t.radius+r.radius;n<=c*c&&(a=c-Math.sqrt(n),a+=.5,s=t.mass+r.mass,o=this.mass?r.mass/s:.5,h=this.mass?t.mass/s:.5,t.p.add(this.delta.clone().normalize().multiplyScalar(a*-o)),r.p.add(this.delta.normalize().multiplyScalar(a*h)),this.callback&&this.callback(t,r))}},e}(Z),it=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).reset(e,i),a.name="CrossZone",a}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n){this.zone=e,this.zone.crossType=v.initValue(i,"dead"),r&&t.prototype.reset.call(this,r,n)},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),this.zone.crossing(t)},e}(Z),rt=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).same=void 0,a.a=void 0,a.b=void 0,a.name=void 0,a.reset(e,i),a.name="Alpha",a}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n){this.same=null==i,this.a=S.setSpanValue(v.initValue(e,1)),this.b=S.setSpanValue(i),r&&t.prototype.reset.call(this,r,n)},r.initialize=function(t){t.data.alphaA=this.a.getValue(),this.same?t.data.alphaB=t.data.alphaA:t.data.alphaB=this.b.getValue()},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),t.alpha=t.data.alphaB+(t.data.alphaA-t.data.alphaB)*this.energy,t.alpha<.001&&(t.alpha=0)},e}(Z),nt=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).same=void 0,a.name=void 0,a.reset(e,i),a.name="Scale",a}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n){this.same=null==i,this.a=S.setSpanValue(v.initValue(e,1)),this.b=S.setSpanValue(i),r&&t.prototype.reset.call(this,r,n)},r.initialize=function(t){t.data.scaleA=this.a.getValue(),t.data.oldRadius=t.radius,t.data.scaleB=this.same?t.data.scaleA:this.b.getValue()},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),t.scale=t.data.scaleB+(t.data.scaleA-t.data.scaleB)*this.energy,t.scale<1e-4&&(t.scale=0),t.radius=t.data.oldRadius*t.scale},e}(Z),at=function(t){function e(e,i,r,n,a){var s;return(s=t.call(this,n,a)||this).same=void 0,s.a=void 0,s.b=void 0,s.style=void 0,s.name=void 0,s.reset(e,i,r),s.name="Rotate",s}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n,a){this.same=null==i,this.a=S.setSpanValue(v.initValue(e,"Velocity")),this.b=S.setSpanValue(v.initValue(i,0)),this.style=v.initValue(r,"to"),n&&t.prototype.reset.call(this,n,a)},r.initialize=function(t){t.rotation=this.a.getValue(),t.data.rotationA=this.a.getValue(),this.same||(t.data.rotationB=this.b.getValue())},r.applyBehaviour=function(t,e,i){this.calculate(t,e,i),this.same?"V"!==this.a.a&&"Velocity"!==this.a.a&&"v"!==this.a.a||(t.rotation=t.getDirection()):"to"===this.style||"TO"===this.style||"_"===this.style?t.rotation+=t.data.rotationB+(t.data.rotationA-t.data.rotationB)*this.energy:t.rotation+=t.data.rotationB},e}(Z),st=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).reset(e,i),a.name="Color",a}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n){this.a=F.createArraySpan(e),this.b=F.createArraySpan(i),r&&t.prototype.reset.call(this,r,n)},r.initialize=function(t){t.color=this.a.getValue(),t.data.colorA=V.hexToRgb(t.color),this.b&&(t.data.colorB=V.hexToRgb(this.b.getValue()))},r.applyBehaviour=function(t,e,i){this.b?(this.calculate(t,e,i),t.rgb.r=t.data.colorB.r+(t.data.colorA.r-t.data.colorB.r)*this.energy,t.rgb.g=t.data.colorB.g+(t.data.colorA.g-t.data.colorB.g)*this.energy,t.rgb.b=t.data.colorB.b+(t.data.colorA.b-t.data.colorB.b)*this.energy,t.rgb.r=t.rgb.r|0,t.rgb.g=t.rgb.g|0,t.rgb.b=t.rgb.b|0):(t.rgb.r=t.data.colorA.r,t.rgb.g=t.data.colorA.g,t.rgb.b=t.data.colorA.b)},e}(Z),ot="changing",ht=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).setAngleAndForce(e,i),a.name="Cyclone",a}i(e,t);var r=e.prototype;return r.setAngleAndForce=function(t,e){this.force=ot,this.angle=T.PI/2,"right"===t?this.angle=T.PI/2:"left"===t?this.angle=-T.PI/2:"random"===t?this.angle="random":t instanceof S?(this.angle="span",this.span=t):t&&(this.angle=t),"changing"===String(e).toLowerCase()||"chang"===String(e).toLowerCase()||"auto"===String(e).toLowerCase()?this.force=ot:e&&(this.force=e)},r.reset=function(e,i,r,n){this.angle=T.PI/2,this.setAngleAndForce(e,i),r&&t.prototype.reset.call(this,r,n)},r.initialize=function(t){"random"===this.angle?t.data.cangle=T.randomAToB(-T.PI,T.PI):"span"===this.angle&&(t.data.cangle=this.span.getValue()),t.data.cyclone=new M(0,0)},r.applyBehaviour=function(t,e,i){var r;this.calculate(t,e,i);var n=t.v.getGradient();"random"===this.angle||"span"===this.angle?n+=t.data.cangle:n+=this.angle,r=this.force===ot?t.v.length()/100:this.force,t.data.cyclone.x=r*Math.cos(n),t.data.cyclone.y=r*Math.sin(n),t.data.cyclone=this.normalizeForce(t.data.cyclone),t.a.add(t.data.cyclone)},e}(Z),ut=function(t){function e(e,i,r,n,a){var s;return(s=t.call(this,e,i,r,n,a)||this).force*=-1,s.name="Repulsion",s}return i(e,t),e.prototype.reset=function(e,i,r,n,a){t.prototype.reset.call(this,e,i,r,n,a),this.force*=-1},e}(J),lt=function(t){function e(e,i,r,n){var a;return(a=t.call(this,r,n)||this).distanceVec=new M,a.centerPoint=v.initValue(e,new M),a.force=v.initValue(a.normalizeValue(i),100),a.name="GravityWell",a}i(e,t);var r=e.prototype;return r.reset=function(e,i,r,n){this.distanceVec=new M,this.centerPoint=v.initValue(e,new M),this.force=v.initValue(this.normalizeValue(i),100),r&&t.prototype.reset.call(this,r,n)},r.initialize=function(t){},r.applyBehaviour=function(t,e,i){this.distanceVec.set(this.centerPoint.x-t.p.x,this.centerPoint.y-t.p.y);var r=this.distanceVec.lengthSq();if(0!==r){var n=this.distanceVec.length(),a=this.force*e/(r*n);t.v.x+=a*this.distanceVec.x,t.v.y+=a*this.distanceVec.y}},e}(Z),ct={initialize:function(t,e,i){var r,n=i.length;for(r=0;r<n;r++)i[r]instanceof G?i[r].init(t,e):this.init(t,e,i[r]);this.bindEmitter(t,e)},init:function(t,e,i){k.setProp(e,i),k.setVectorVal(e,i)},bindEmitter:function(t,e){t.bindEmitter&&(e.p.add(t.p),e.v.add(t.v),e.a.add(t.a),e.v.rotate(T.degreeTransform(t.rotation)))}},dt=function(t){function e(e){var i;return void 0===e&&(e={}),(i=t.call(this,e)||this).particles=[],i.behaviours=[],i.initializes=[],i.emitTime=0,i.emitSpeed=0,i.totalTime=-1,i.damping=.006,i.bindEmitter=!0,i.rate=new O(1,.1),i.name="Emitter",i.id=_.id(i.name),i}i(e,t);var r=e.prototype;return r.emit=function(t,e){this.stoped=!1,this.emitTime=0,this.totalTime=v.initValue(t,1/0),!0===e||"life"===e||"destroy"===e?this.life="once"===t?1:this.totalTime:isNaN(e)||(this.life=e),this.rate.init()},r.stop=function(){this.totalTime=-1,this.emitTime=0,this.stoped=!0},r.preEmit=function(t){var e=this.stoped,i=this.emitTime,r=this.totalTime;this.stoped=!1,this.emitTime=0,this.totalTime=t,this.rate.init();for(var n=.0167;t>n;)t-=n,this.update(n);this.stoped=e,this.emitTime=i+Math.max(t,0),this.totalTime=r},r.removeAllParticles=function(){for(var t=this.particles,e=t.length,i=0;i<e;i++)t[i].dead=!0},r.addSelfInitialize=function(t){t.init&&t.init(this)},r.addInitialize=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var r=e.length;r--;)this.initializes.push(e[r])},r.removeInitialize=function(t){var e=this.initializes.indexOf(t);e>-1&&this.initializes.splice(e,1)},r.removeAllInitializers=function(){v.emptyArray(this.initializes)},r.addBehaviour=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var r=arguments.length;r--;){var n=e[r];this.behaviours.push(n),n.parents&&n.parents.push(this)}},r.removeBehaviour=function(t){var e=this.behaviours.indexOf(t);return this.behaviours.splice(e,1),t.parents&&(e=t.parents.indexOf(t),t.parents.splice(e,1)),e},r.removeAllBehaviours=function(){v.emptyArray(this.behaviours)},r.update=function(t){this.age+=t,this.age>=this.life||this.dead?this.destroy():(this.emitting(t),this.integrate(t))},r.integrate=function(t){if(this.parent){var e=1-this.damping;this.parent.integrator.calculate(this,t,e);for(var i=this.particles,r=i.length,n=this.parent,a=n.pool,s=n.integrator,o=Boolean(this.parent||this.bindEvent),h=r,u=0;u<h;){var l=i[u];if(l.update(t,u),s.calculate(l,t,e),o&&r<1e4&&this.dispatch("PARTICLE_UPDATE",l),l.dead){if(o&&r<1e4&&this.dispatch("PARTICLE_DEAD",l),u<--h){i[u]=i[h],i[h]=l,a.expire(l);continue}a.expire(l)}u++}h<r&&(i.length=h)}},r.dispatch=function(t,e){(this.parent||this.bindEvent)&&(this.particles&&this.particles.length>5e4&&"PARTICLE_CREATED"!==t&&"PARTICLE_DEAD"!==t||(this.parent&&this.parent.dispatchEvent(t,e),this.bindEvent&&this.dispatchEvent(t,e)))},r.emitting=function(t){if(!this.stoped){var e=1e4,i=this.emitTime,r=this.totalTime;if("none"!==r){if("once"===r){var n=this.rate.getValue(99999);if(n>e&&(process&&process.env&&"development"===process.env.NODE_ENV&&console.warn("Attempting to emit "+n+" particles at once, capped to "+e),n=e),n<=0)return;return this.emitSpeed=n,this._fastCreateParticles(n),void(this.totalTime="none")}if(i+=t,this.emitTime=i,i<r){var a=this.rate.getValue(t);if(a<=0)return;a>e&&(a=e),this.emitSpeed=a,this._fastCreateParticles(a)}}else this.emitTime=i+t}},r._fastCreateParticles=function(t){if(!(t<=0)&&this.parent){var e,i=this.parent.pool,r=this.particles,n=this.initializes,a=this.behaviours,s=1e6;if(!(r.length+t>s&&(t=Math.max(0,s-r.length))<=0))i.getBulk?(e=i.getBulk(U,t),this._initializeParticlesBulk(e,n,a)):this._createParticlesLoop(t,i,r,n,a)}},r._createParticlesLoop=function(t,e,i,r,n){if(i.length,0===i.length&&t>1e4)try{i.length=t,i.length=0}catch(t){}for(var a,s=(this.parent||this.bindEvent)&&i.length<1e4?this.dispatch.bind(this):null,o=0;o<t;)(a=e.get(U)).reset(),ct.initialize(this,a,r),a.addBehaviours(n),a.parent=this,i.push(a),s&&s("PARTICLE_CREATED",a),o++},r._initializeParticlesBulk=function(t,e,i){for(var r=t.length,n=this.particles,a=(this.parent||this.bindEvent)&&n.length<1e4?this.dispatch.bind(this):null,s=0;s<r;s++){var o=t[s];ct.initialize(this,o,e),o.parent=this,o.addBehaviours(i),n.push(o),a&&a("PARTICLE_CREATED",o)}},r.createParticlesBatch=function(t,e,i){if(e||i){var r=5e3;if(t>r&&t>1e4)for(var n=0;n<t;n+=r){var a=Math.min(r,t-n);this._createParticleChunk(a,e,i)}else this._createParticleChunk(t,e,i)}else this._fastCreateParticles(t)},r._createParticleChunk=function(t,e,i){if(!(t<=0)){var r=this.parent.pool,n=this.particles,a=1e6;if(!(n.length+t>a&&(t=Math.max(0,a-n.length))<=0)){var s=(this.parent||this.bindEvent)&&n.length<1e4,o=e?v.toArray(e):this.initializes,h=i?v.toArray(i):this.behaviours,u=s?this.dispatch.bind(this):null;if(Array.prototype.reserve){var l=n.length+t;n.capacity<l&&n.reserve(l)}for(var c,d=0;d<t;)(c=r.get(U)).reset(),ct.initialize(this,c,o),c.addBehaviours(h),c.parent=this,n.push(c),u&&u("PARTICLE_CREATED",c),d++}}},r.createParticle=function(t,e){if(!this.parent)return null;var i=this.parent.pool.get(U);i.reset();var r=t?v.toArray(t):this.initializes,n=e?v.toArray(e):this.behaviours;return ct.initialize(this,i,r),i.addBehaviours(n),i.parent=this,this.particles.push(i),(this.parent||this.bindEvent)&&this.particles.length<1e4&&this.dispatch("PARTICLE_CREATED",i),i},r.setupParticle=function(t,e,i){t.reset();var r=e?v.toArray(e):this.initializes,n=i?v.toArray(i):this.behaviours;ct.initialize(this,t,r),t.addBehaviours(n),t.parent=this,this.particles.push(t)},r.remove=function(){this.stop();var t=this.particles,e=t.length;if(this.parent&&this.parent.pool)for(var i=this.parent.pool,r=0;r<e;r++)i.expire(t[r]);t.length=0},r.destroy=function(){this.dead=!0,this.remove(),this.removeAllInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this),this.rate=null,this.old=null,this.rgb=null,this.v=null,this.a=null,this.p=null},e}(U);E.bind(dt);var pt,ft=function(t){function e(e){var i;return(i=t.call(this,e)||this).selfBehaviours=[],i}i(e,t);var r=e.prototype;return r.addSelfBehaviour=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r,n=e.length;for(r=0;r<n;r++){var a=e[r];this.selfBehaviours.push(a),a.initialize(this)}},r.removeSelfBehaviour=function(t){var e=this.selfBehaviours.indexOf(t);e>-1&&this.selfBehaviours.splice(e,1)},r.update=function(e){if(t.prototype.update.call(this,e),!this.sleep){var i,r=this.selfBehaviours.length;for(i=0;i<r;i++)this.selfBehaviours[i].applyBehaviour(this,e,i)}},e}(dt),mt=function(t){function e(e,i,r){var n;return(n=t.call(this,r)||this).mouseTarget=v.initValue(e,window),n.ease=v.initValue(i,.7),n._allowEmitting=!1,n.initEventHandler(),n}i(e,t);var r=e.prototype;return r.initEventHandler=function(){var t=this;this.mousemoveHandler=function(e){return t.mousemove.call(t,e)},this.mousedownHandler=function(e){return t.mousedown.call(t,e)},this.mouseupHandler=function(e){return t.mouseup.call(t,e)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},r.emit=function(){this._allowEmitting=!0},r.stop=function(){this._allowEmitting=!1},r.mousemove=function(e){e.layerX||0===e.layerX?(this.p.x+=(e.layerX-this.p.x)*this.ease,this.p.y+=(e.layerY-this.p.y)*this.ease):(e.offsetX||0===e.offsetX)&&(this.p.x+=(e.offsetX-this.p.x)*this.ease,this.p.y+=(e.offsetY-this.p.y)*this.ease),this._allowEmitting&&t.prototype.emit.call(this,"once")},r.destroy=function(){t.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},e}(dt),yt=function(t){if(!t)return!1;if(t.__isImage)return!0;var e=(""+t.tagName).toUpperCase();return("IMG"===(""+t.nodeName).toUpperCase()||"IMG"===e)&&(t.__isImage=!0,!0)},gt=function(t){return"string"==typeof t},vt=function(){function t(t,e){this.pool=new x,this.element=t,this.stroke=e,this.circleConf={isCircle:!0},this.initEventHandler(),this.name="BaseRenderer"}var e=t.prototype;return e.setStroke=function(t,e){void 0===t&&(t="#000000"),void 0===e&&(e=1),this.stroke={color:t,thinkness:e}},e.initEventHandler=function(){var t=this;this._protonUpdateHandler=function(){t.onProtonUpdate.call(t)},this._protonUpdateAfterHandler=function(){t.onProtonUpdateAfter.call(t)},this._emitterAddedHandler=function(e){t.onEmitterAdded.call(t,e)},this._emitterRemovedHandler=function(e){t.onEmitterRemoved.call(t,e)},this._particleCreatedHandler=function(e){t.onParticleCreated.call(t,e)},this._particleUpdateHandler=function(e){t.onParticleUpdate.call(t,e)},this._particleDeadHandler=function(e){t.onParticleDead.call(t,e)}},e.init=function(t){this.parent=t,t.addEventListener("PROTON_UPDATE",this._protonUpdateHandler),t.addEventListener("PROTON_UPDATE_AFTER",this._protonUpdateAfterHandler),t.addEventListener("EMITTER_ADDED",this._emitterAddedHandler),t.addEventListener("EMITTER_REMOVED",this._emitterRemovedHandler),t.addEventListener("PARTICLE_CREATED",this._particleCreatedHandler),t.addEventListener("PARTICLE_UPDATE",this._particleUpdateHandler),t.addEventListener("PARTICLE_DEAD",this._particleDeadHandler)},e.resize=function(t,e){},e.destroy=function(){this.remove(),this.pool.destroy(),this.pool=null,this.element=null,this.stroke=null},e.remove=function(t){this.parent.removeEventListener("PROTON_UPDATE",this._protonUpdateHandler),this.parent.removeEventListener("PROTON_UPDATE_AFTER",this._protonUpdateAfterHandler),this.parent.removeEventListener("EMITTER_ADDED",this._emitterAddedHandler),this.parent.removeEventListener("EMITTER_REMOVED",this._emitterRemovedHandler),this.parent.removeEventListener("PARTICLE_CREATED",this._particleCreatedHandler),this.parent.removeEventListener("PARTICLE_UPDATE",this._particleUpdateHandler),this.parent.removeEventListener("PARTICLE_DEAD",this._particleDeadHandler),this.parent=null},e.onProtonUpdate=function(){},e.onProtonUpdateAfter=function(){},e.onEmitterAdded=function(t){},e.onEmitterRemoved=function(t){},e.onParticleCreated=function(t){},e.onParticleUpdate=function(t){},e.onParticleDead=function(t){},t}(),bt=function(t){function e(e){var i;return(i=t.call(this,e)||this).stroke=void 0,i.context=void 0,i.bufferCache=void 0,i.name=void 0,i.stroke=null,i.context=i.element.getContext("2d"),i.bufferCache={},i.name="CanvasRenderer",i}i(e,t);var r=e.prototype;return r.resize=function(t,e){this.element.width=t,this.element.height=e},r.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},r.onParticleCreated=function(t){t.body?y(t.body,this.addImg2Body,t):t.color=t.color||"#ff0000"},r.onParticleUpdate=function(t){t.body?yt(t.body)&&this.drawImage(t):this.drawCircle(t)},r.onParticleDead=function(t){t.body=null},r.addImg2Body=function(t,e){e.body=t},r.drawImage=function(t){var e=t.body.width*t.scale|0,i=t.body.height*t.scale|0,r=t.p.x-e/2,n=t.p.y-i/2;if(t.color){t.data.buffer||(t.data.buffer=this.createBuffer(t.body));var a=t.data.buffer.getContext("2d");a.clearRect(0,0,t.data.buffer.width,t.data.buffer.height),a.globalAlpha=t.alpha,a.drawImage(t.body,0,0),a.globalCompositeOperation="source-atop",a.fillStyle=V.rgbToHex(t.rgb),a.fillRect(0,0,t.data.buffer.width,t.data.buffer.height),a.globalCompositeOperation="source-over",a.globalAlpha=1,this.context.drawImage(t.data.buffer,0,0,t.data.buffer.width,t.data.buffer.height,r,n,e,i)}else this.context.save(),this.context.globalAlpha=t.alpha,this.context.translate(t.p.x,t.p.y),this.context.rotate(T.degreeTransform(t.rotation)),this.context.translate(-t.p.x,-t.p.y),this.context.drawImage(t.body,0,0,t.body.width,t.body.height,r,n,e,i),this.context.globalAlpha=1,this.context.restore()},r.drawCircle=function(t){t.rgb?this.context.fillStyle="rgba("+t.rgb.r+","+t.rgb.g+","+t.rgb.b+","+t.alpha+")":this.context.fillStyle=t.color,this.context.beginPath(),this.context.arc(t.p.x,t.p.y,t.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()},r.createBuffer=function(t){if(yt(t)){var e=t.width+"_"+t.height,i=this.bufferCache[e];return i||((i=document.createElement("canvas")).width=t.width,i.height=t.height,this.bufferCache[e]=i),i}},r.destroy=function(){t.prototype.destroy.call(this),this.stroke=null,this.context=null,this.bufferCache=null},e}(vt),_t=function(t){function e(e){var i;return(i=t.call(this,e)||this).stroke=null,i.transform3d=!1,i.pool.create=function(t,e){return i.createBody(t,e)},i.addImg2Body=i.addImg2Body.bind(i),i.name="DomRenderer",i}i(e,t);var r=e.prototype;return r.onParticleCreated=function(t){t.body?y(t.body,this.addImg2Body,t):(t.body=this.pool.get(this.circleConf,t),this.element.appendChild(t.body))},r.onParticleUpdate=function(t){this.bodyReady(t)&&(this.transform3d?c.transform3d(t.body,t.p.x,t.p.y,t.scale,t.rotation):c.transform(t.body,t.p.x,t.p.y,t.scale,t.rotation),t.body.style.opacity=t.alpha,t.body.isCircle&&(t.body.style.backgroundColor=t.color||"#ff0000"))},r.onParticleDead=function(t){this.bodyReady(t)&&(this.element.removeChild(t.body),this.pool.expire(t.body),t.body=null)},r.bodyReady=function(t){return"object"==typeof t.body&&t.body&&!t.body.isInner},r.addImg2Body=function(t,e){e.dead||(e.body=this.pool.get(t,e),c.resize(e.body,t.width,t.height),this.element.appendChild(e.body))},r.createBody=function(t,e){return t.isCircle?this.createCircle(e):this.createSprite(t,e)},r.createCircle=function(t){var e=c.createDiv(t.id+"_dom",2*t.radius,2*t.radius);return e.style.borderRadius=t.radius+"px",this.stroke&&(e.style.borderColor=this.stroke.color,e.style.borderWidth=this.stroke.thinkness+"px"),e.isCircle=!0,e},r.createSprite=function(t,e){var i="string"==typeof t?t:t.src,r=c.createDiv(e.id+"_dom",t.width,t.height);return r.style.backgroundImage="url("+i+")",r},r.destroy=function(){t.prototype.destroy.call(this),this.stroke=null},e}(vt),xt=function(t){function e(e,i){var r;return(r=t.call(this,e)||this).stroke=i,r.name="EaselRenderer",r}i(e,t);var r=e.prototype;return r.onParticleCreated=function(t){t.body?this.createSprite(t):this.createCircle(t),this.element.addChild(t.body)},r.onParticleUpdate=function(t){t.body&&(t.body.x=t.p.x,t.body.y=t.p.y,t.body.alpha=t.alpha,t.body.scaleX=t.body.scaleY=t.scale,t.body.rotation=t.rotation)},r.onParticleDead=function(t){t.body&&(t.body.parent&&t.body.parent.removeChild(t.body),this.pool.expire(t.body),t.body=null),t.graphics&&this.pool.expire(t.graphics)},r.createSprite=function(t){t.body=this.pool.get(t.body),t.body.parent||t.body.image&&(t.body.regX=t.body.image.width/2,t.body.regY=t.body.image.height/2)},r.createCircle=function(t){var e=this.pool.get(window.createjs.Graphics);this.stroke&&(gt(this.stroke)?e.beginStroke(this.stroke):e.beginStroke("#000000")),e.beginFill(t.color||"#ff0000").drawCircle(0,0,t.radius);var i=this.pool.get(window.createjs.Shape,[e]);t.body=i,t.graphics=e},r.destroy=function(){t.prototype.destroy.call(this),this.stroke=null},e}(vt),wt=function(t){function e(e,i){var r;return(r=t.call(this,e)||this).context=r.element.getContext("2d"),r.imageData=null,r.rectangle=i,r.createImageData(i),r.name="PixelRenderer",r}i(e,t);var r=e.prototype;return r.resize=function(t,e){this.element.width=t,this.element.height=e},r.createImageData=function(t){this.rectangle=t||new z(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},r.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)},r.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},r.onParticleCreated=function(t){},r.onParticleUpdate=function(t){this.imageData&&this.setPixel(this.imageData,t.p.x-this.rectangle.x|0,t.p.y-this.rectangle.y|0,t)},r.setPixel=function(t,e,i,r){var n=r.rgb;if(!(e<0||e>this.element.width||i<0||i>this.element.height)){var a=4*((i|0)*t.width+(e|0));t.data[a]=n.r,t.data[a+1]=n.g,t.data[a+2]=n.b,t.data[a+3]=255*r.alpha}},r.onParticleDead=function(t){},r.destroy=function(){t.prototype.destroy.call(this),this.stroke=null,this.context=null,this.imageData=null,this.rectangle=null},e}(vt),Et=function(e){function n(t,i,r){var n;if(void 0===r&&(r={}),(n=e.call(this,t)||this).stroke=i,n.color=!1,n.setColor=!1,n.blendMode=null,n.options=r,n.pool.create=function(t,e){return n.createBody(t,e)},n.setPIXI(window.PIXI),n.name="PixiRenderer",n._textureCache=new Map,n._updateThrottle=r.updateThrottle||5,n._updateCounter=0,n._particleUpdates=new Set,n._frameSkipCounter=0,n._frameSkipThreshold=r.frameSkipThreshold||6,n._enableCulling=!1!==r.enableCulling,n._cullingBounds=null,n._setDefaultCullingBounds(),n._priorityUpdates=new Set,n._lowPriorityUpdates=new Set,n._updatePriorityThreshold=r.updatePriorityThreshold||.3,n._piBy180=T.PI_180,n._lastUpdateTime=performance.now(),n._frameTime=0,n._throttleAdjustCounter=0,n._autoAdjustThrottle=!1!==r.autoAdjustThrottle,n._useStableSort=!1!==r.useStableSort,n._renderBatchSize=r.renderBatchSize||512,n._disableAlphaDirty=r.disableAlphaDirty||!1,n._disableRenderUpdates=!1,n._renderUpdateCounter=0,n._renderUpdateThreshold=r.renderUpdateThreshold||2,n._installRendererOptimizations(),n._rafManager={enabled:!0,lastFrameTime:0,minFrameTime:16,frameId:null,rafCallback:null,install:function(){var t=this;window.originalRequestAnimationFrame||(window.originalRequestAnimationFrame=window.requestAnimationFrame,window.requestAnimationFrame=function(e){return t.rafCallback=e,t.frameId||t.scheduleFrame(),1})},scheduleFrame:function(){var t=this;this.frameId=window.originalRequestAnimationFrame((function(e){var i=e-t.lastFrameTime;if(i>=t.minFrameTime||i>33){t.lastFrameTime=e;var r=t.rafCallback;if(t.rafCallback=null,t.frameId=null,r)try{performance.mark("raf-start"),r(e),performance.mark("raf-end"),performance.measure("raf-duration","raf-start","raf-end");var n=performance.getEntriesByName("raf-duration");if(n.length>0){var a=n[0].duration;performance.clearMarks(),performance.clearMeasures(),a>20?t.minFrameTime=Math.min(t.minFrameTime+2,32):a<12&&t.minFrameTime>16&&(t.minFrameTime=Math.max(t.minFrameTime-1,16))}}catch(e){console.error("Error in RAF callback:",e),t.frameId=null}}else t.frameId=window.originalRequestAnimationFrame(t.scheduleFrame.bind(t))}))},uninstall:function(){window.originalRequestAnimationFrame&&(window.requestAnimationFrame=window.originalRequestAnimationFrame,window.originalRequestAnimationFrame=null),this.frameId&&(window.cancelAnimationFrame(this.frameId),this.frameId=null)}},n._rafManager.install(),"undefined"!=typeof SharedArrayBuffer&&window.crossOriginIsolated)try{n._sharedBuffer=new SharedArrayBuffer(16777216),n._sharedView=new Float32Array(n._sharedBuffer),n._sharedInt32View=new Int32Array(n._sharedBuffer),n._bufferLock=0,n._setupParallelProcessing()}catch(t){console.warn("SharedArrayBuffer not available:",t)}return navigator.gpu&&n._setupWebGPU(),n}i(n,e);var a=n.prototype;return a._setDefaultCullingBounds=function(){try{if(pt&&pt.renderer){var t=pt.renderer.width||800,e=pt.renderer.height||600;this._cullingBounds={minX:.25*-t,minY:.25*-e,maxX:1.25*t,maxY:1.25*e}}else this._cullingBounds={minX:-1e3,minY:-1e3,maxX:2e3,maxY:2e3}}catch(t){this._cullingBounds={minX:-1e3,minY:-1e3,maxX:2e3,maxY:2e3}}},a._installRendererOptimizations=function(){try{if(!pt||!pt.renderer)return;if(pt.renderer.renderPipes&&pt.renderer.renderPipes.batch){var t=pt.renderer.renderPipes.batch;if(t.MAX_TEXTURES&&(t.MAX_TEXTURES=Math.min(t.MAX_TEXTURES,16)),this._useStableSort&&t._renderGroups&&"function"==typeof t._renderGroups.sort){var e=t._renderGroups.sort;t._renderGroups.sort=function(t,i){return t.zIndex===i.zIndex?t.layerNumber-i.layerNumber:e(t,i)}}}pt.SystemRunner&&this._optimizeSystemRunner(),pt.buildInstructions&&this._optimizeBuildInstructions(),this._disableUnnecessaryUpdates(),pt.renderer&&pt.renderer.plugins&&pt.renderer.plugins.accessibility&&(pt.renderer.plugins.accessibility.destroy(),pt.renderer.plugins.accessibility=null,pt.settings&&(pt.settings.ACCESSIBILITY_SUPPORT=!1)),this._optimizeBatchPipeline(),this._optimizeRenderGroupSystem(),this._limitAnimationFrameRate(),this._optimizeBatchOperations(),this._setupPackAttributesWorker()}catch(t){console.warn("Error installing renderer optimizations:",t)}},a._optimizeSystemRunner=function(){try{var t=pt.SystemRunner.prototype;if(!t||!t.emit||this._systemRunnerOptimized)return;this._systemRunnerOptimized=!0;var e=t.emit;if(t.emit=function(t){if(("render"===t||"postrender"===t)&&(void 0===window._pixiRenderSkipCounter&&(window._pixiRenderSkipCounter=0),window._pixiRenderSkipCounter++,window._pixiRenderSkipCounter%4!=0&&"render"===t||window._pixiRenderSkipCounter%6!=0&&"postrender"===t))return this;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return e.call.apply(e,[this,t].concat(r))},pt.accessibleTarget&&pt.AccessibilityManager){pt.accessibleTarget.updateAccessibleTransform=function(){};var i=t.emit;t.emit=function(t){if("postrender"===t&&"AccessibilitySystem"===this.name)return this;if(("render"===t||"postrender"===t)&&(void 0===window._pixiRenderSkipCounter&&(window._pixiRenderSkipCounter=0),window._pixiRenderSkipCounter++,window._pixiRenderSkipCounter%5!=0&&"render"===t||window._pixiRenderSkipCounter%7!=0&&"postrender"===t))return this;for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return i.call.apply(i,[this,t].concat(r))}}if(pt.Ticker&&pt.Ticker.system){var r=pt.Ticker.system;if(r.maxFPS=30,r.update){var n=r.update;r.update=function(t){if(window._pixiRenderSkipCounter%2==0){if(this.lastTime){var e=Math.min(t,this.lastTime+50);return n.call(this,e)}return n.call(this,t)}}}}}catch(t){console.warn("Error optimizing SystemRunner:",t)}},a._optimizeBuildInstructions=function(){var t=this;try{var e=pt.buildInstructions;if(!e||this._buildInstructionsOptimized)return;this._buildInstructionsOptimized=!0;var i=new Map;pt.buildInstructions=function(r,n){if(!t._disableRenderUpdates){var a=n.uid||n.id;if(i.has(a)&&!n._structureDidChange)return i.get(a);if(t._renderUpdateCounter++,t._renderUpdateCounter%(2*t._renderUpdateThreshold)!=0)return i.get(a);var s=e(r,n);if(a&&(i.set(a,s),i.size>100)){var o=i.keys().next().value;i.delete(o)}return s}}}catch(t){console.warn("Error optimizing buildInstructions:",t)}},a._disableUnnecessaryUpdates=function(){try{if(this._disableAlphaDirty&&pt.Container&&pt.Container.prototype){var t=pt.Container.prototype,e=t.updateTransform;e&&!this._updateTransformOptimized&&(this._updateTransformOptimized=!0,t.updateTransform=function(){var t=this.worldAlpha,i=e.call(this);return Math.abs(this.worldAlpha-t)<.01&&(this._alphaDirty=!1),i})}}catch(t){console.warn("Error disabling unnecessary updates:",t)}},a.setPIXI=function(t){try{pt=t||{Sprite:{}},this.createFromImage=pt.Sprite.from||pt.Sprite.fromImage,this.isV8="string"==typeof pt.VERSION&&parseInt(pt.VERSION.split(".")[0],10)>=8,this.isV8&&pt.ParticleContainer&&this._setupParticleContainer(),this._installRendererOptimizations()}catch(t){console.warn("Error setting up PIXI in PixiRenderer:",t)}},a._setupParticleContainer=function(){if(this.element&&this.element.parent){var t=this.element.parent,e=t.children.indexOf(this.element),i=this.options.dynamicProperties||{position:!0,scale:!1,rotation:!1,color:!1},r=this.options.maxSize||1e4,n=this.options.batchSize||this._renderBatchSize;this.particleContainer=new pt.ParticleContainer({dynamicProperties:i,maxSize:r,batchSize:n}),void 0!==this.particleContainer.autoSort&&(this.particleContainer.autoSort=!1),void 0!==this.particleContainer.enableTempParent&&(this.particleContainer.enableTempParent=!1),-1!==e?(t.removeChildAt(e),t.addChildAt(this.particleContainer,e)):t.addChild(this.particleContainer),this.originalContainer=this.element,this.element=this.particleContainer}},a._shouldProcessUpdates=function(){var t=this;this._disableRenderUpdates=!0,this._frameTime>20?this._frameSkipCounter=(this._frameSkipCounter+1)%(2*this._frameSkipThreshold):this._frameSkipCounter=(this._frameSkipCounter+1)%this._frameSkipThreshold;var e=0===this._frameSkipCounter;return e&&this._queueMicroTask((function(){t._disableRenderUpdates=!1})),e},a._adjustThrottleIfNeeded=function(){if(this._autoAdjustThrottle&&(this._throttleAdjustCounter++,!(this._throttleAdjustCounter<30))){var t=performance.now(),e=t-this._lastUpdateTime;if(this._lastUpdateTime=t,this._frameTime=.8*this._frameTime+.2*e,this._frameTime>16.7?(this._updateThrottle=Math.min(this._updateThrottle+1,8),this._renderUpdateThreshold=Math.min(this._renderUpdateThreshold+2,6)):this._frameTime<10&&this._updateThrottle>1&&(this._updateThrottle=Math.max(this._updateThrottle-1,1),this._renderUpdateThreshold=Math.max(this._renderUpdateThreshold-1,1)),this._throttleAdjustCounter=0,pt&&pt.renderer){var i=pt.renderer.width||800,r=pt.renderer.height||600;this._cullingBounds={minX:.25*-i,minY:.25*-r,maxX:1.25*i,maxY:1.25*r}}}},a.onProtonUpdate=function(){var t=this;if(this._adjustThrottleIfNeeded(),this._shouldProcessUpdates()){this._processPriorityUpdates(),this._processNormalUpdates();var e=performance.now();!function(){if(performance.now()-e>10){if(t._disableRenderUpdates=!0,t._lowPriorityUpdates.clear(),t._particleUpdates.clear(),t._priorityUpdates.size>50){var i=Array.from(t._priorityUpdates).slice(0,50);t._priorityUpdates.clear(),i.forEach((function(e){return t._priorityUpdates.add(e)}))}return!1}}()}},a._processPriorityUpdates=function(){var t=this;this.isV8&&0!==this._priorityUpdates.size?(this._priorityUpdates.forEach((function(e){if(e&&e.body){e.body.x=e.p.x,e.body.y=e.p.y,e.body.alpha=e.alpha;var i=t.element.dynamicProperties||{};i.scale&&(e.body.scale=e.scale),i.rotation&&(e.body.rotation=e.rotation*t._piBy180)}})),this._priorityUpdates.clear()):this._priorityUpdates.clear()},a._processNormalUpdates=function(){if(!this.isV8||0===this._particleUpdates.size&&0===this._lowPriorityUpdates.size)return this._particleUpdates.clear(),void this._lowPriorityUpdates.clear();this._particleUpdates.size>0&&(this._particleUpdates.forEach((function(t){t&&t.body&&(t.body.x=t.p.x,t.body.y=t.p.y,t.body.alpha=t.alpha)})),this._particleUpdates.clear()),this._updateCounter%3==0&&this._lowPriorityUpdates.size>0&&(this._lowPriorityUpdates.forEach((function(t){t&&t.body&&(t.body.x=t.p.x,t.body.y=t.p.y)})),this._lowPriorityUpdates.clear())},a.onParticleCreated=function(t){t&&(this.isV8&&pt.ParticleContainer&&pt.Particle?this._createV8Particle(t):this._createLegacyParticle(t))},a._createV8Particle=function(t){var e=this;if(t.body)t.body=this.pool.get(t.body,t);else{var i=new pt.Particle({texture:this.getTexture(t),x:t.p.x,y:t.p.y,scale:t.scale,rotation:t.rotation*this._piBy180,alpha:t.alpha,anchor:.5});(this.color||this.setColor)&&(i.tint=V.getHex16FromParticle(t)),t.body=i}null!=this.blendMode&&(t.body.blendMode=this.blendMode),this._particlesToAdd||(this._particlesToAdd=[],setTimeout((function(){e._particlesToAdd&&e._particlesToAdd.length&&(e._particlesToAdd.forEach((function(t){return e.element.addParticle(t)})),e._particlesToAdd=[])}),0)),this._particlesToAdd.push(t.body)},a._createLegacyParticle=function(t){t.body=t.body?this.pool.get(t.body,t):this.pool.get(this.circleConf,t),null!=this.blendMode&&(t.body.blendMode=this.blendMode),this.element.addChild(t.body)},a._getParticlePriority=function(t){if(!t)return"low";if(Math.sqrt(t.v.x*t.v.x+t.v.y*t.v.y)>this._updatePriorityThreshold||t.scale>2)return"high";if(this._enableCulling){var e=this._cullingBounds;if(t.p.x<e.minX||t.p.x>e.maxX||t.p.y<e.minY||t.p.y>e.maxY)return"low"}return"normal"},a.getTexture=function(t){if(t.texture)return t.texture;var e="circle_"+(t.radius||5)+"_"+(t.color||36077);if(this._textureCache.has(e))return this._textureCache.get(e);var i=new pt.Graphics,r=t.color||36077;if(i.circle(0,0,t.radius||5).fill(r),this.stroke){var n=gt(this.stroke)?this.stroke:0;i.stroke({width:1,color:n})}var a=pt.Texture.from(i.canvas||i);return this._textureCache.set(e,a),a},a.onParticleUpdate=function(t){if(t&&t.body&&(this._updateCounter++,this._updateCounter%this._updateThrottle==0&&(!this._enableCulling||this._isParticleVisible(t))))if(this.isV8&&t.body instanceof pt.Particle)switch(this._getParticlePriority(t)){case"high":this._priorityUpdates.add(t);break;case"normal":this._particleUpdates.add(t);break;case"low":this._lowPriorityUpdates.add(t)}else"high"!==this._getParticlePriority(t)&&this._updateCounter%3!=0||this._updateLegacyParticle(t)},a._isParticleVisible=function(t){if(!this._cullingBounds)return!0;var e=this._cullingBounds,i=t.p.x,r=t.p.y;return i>=e.minX&&i<=e.maxX&&r>=e.minY&&r<=e.maxY},a._updateV8Particle=function(t){t.body.x=t.p.x,t.body.y=t.p.y,t.body.alpha=t.alpha;var e=this.element.dynamicProperties||{};e.scale&&(t.body.scale=t.scale),e.rotation&&(t.body.rotation=t.rotation*this._piBy180),e.color&&(this.setColor||this.color)&&(t.body.tint=V.getHex16FromParticle(t))},a._updateLegacyParticle=function(t){this.transform(t,t.body),(this.setColor||this.color)&&(this.isV8&&void 0!==t.body.tint?t.body.tint=V.getHex16FromParticle(t):this.isV8||(t.body.tint=V.getHex16FromParticle(t)))},a.onParticleDead=function(t){t&&t.body&&(this._priorityUpdates.delete(t),this._particleUpdates.delete(t),this._lowPriorityUpdates.delete(t),this.isV8&&pt.ParticleContainer&&t.body instanceof pt.Particle?this.element.removeParticle(t.body):(this.element.removeChild(t.body),this.pool.expire(t.body)),t.body=null)},a.transform=function(t,e){e.x=t.p.x,e.y=t.p.y,e.alpha=t.alpha,e.scale.x=e.scale.y=t.scale,e.rotation=t.rotation*this._piBy180},a.createBody=function(t,e){return this.isV8&&pt.ParticleContainer&&pt.Particle?new pt.Particle({texture:t.isInner?pt.Texture.from(t.src):t,x:e.p.x,y:e.p.y,scale:e.scale,rotation:e.rotation*this._piBy180,alpha:e.alpha,anchor:.5}):t.isCircle?this.createCircle(e):this.createSprite(t)},a.createSprite=function(t){var e=t.isInner?this.createFromImage(t.src):new pt.Sprite(t);return e.anchor.set(.5),e},a.createCircle=function(t){var e=t.radius||5,i=t.color||36077,r="circle_"+e+"_"+i;if(this._textureCache.has(r)){var n=this._textureCache.get(r);return new pt.Sprite(n)}var a=new pt.Graphics;if(this.isV8){var s=a.circle(0,0,e).fill(i);if(this.stroke){var o=gt(this.stroke)?this.stroke:0;s.stroke({width:1,color:o})}}else{if(this.stroke){var h=gt(this.stroke)?this.stroke:0;a.lineStyle(1,h)}a.beginFill(i),a.drawCircle(0,0,e),a.endFill()}var u=pt.Texture.from(a.canvas||a);return this._textureCache.set(r,u),a},a.destroy=function(t){if(e.prototype.destroy.call(this),t&&t.length)for(var i=t.length-1;i>=0;i--){var r=t[i];r&&r.body&&(this.isV8&&pt.ParticleContainer&&r.body instanceof pt.Particle?this.element.removeParticle(r.body):this.element.removeChild(r.body))}this._textureCache.clear(),this._particleUpdates.clear(),this._priorityUpdates.clear(),this._lowPriorityUpdates.clear(),this._restoreOriginalContainer(),this._restoreOptimizations(),this._rafManager&&this._rafManager.enabled&&this._rafManager.uninstall()},a._restoreOriginalContainer=function(){if(this.originalContainer&&this.particleContainer){var t=this.particleContainer.parent;if(t){var e=t.children.indexOf(this.particleContainer);-1!==e&&(t.removeChildAt(e),t.addChildAt(this.originalContainer,e)),this.element=this.originalContainer,this.particleContainer=null}}},a._restoreOptimizations=function(){try{this._systemRunnerOptimized&&pt&&pt.SystemRunner&&delete pt.SystemRunner.prototype.emit,this._buildInstructionsOptimized&&pt&&delete pt.buildInstructions,this._updateTransformOptimized&&pt&&pt.Container&&delete pt.Container.prototype.updateTransform}catch(t){console.warn("Error restoring optimizations:",t)}},a._queueMicroTask=function(t){"function"==typeof queueMicrotask?queueMicrotask(t):Promise.resolve().then(t)},a._optimizeBatchPipeline=function(){try{if(pt.renderer&&pt.renderer.renderPipes&&pt.renderer.renderPipes.batch){var t=pt.renderer.renderPipes.batch;if(t.renderer&&t.renderer._gpuContext&&t.renderer._gpuContext.renderTarget&&t.renderer._gpuContext.renderTarget.batchMode&&(t.renderer._gpuContext.renderTarget.batchMode="auto",t.MAX_BATCH_SIZE&&(t.MAX_BATCH_SIZE=Math.max(t.MAX_BATCH_SIZE,8192)),void 0===t._buffersAreStatic&&(t._buffersAreStatic=!0)),t.batcher&&t.batcher.packAttributes){var e=t.batcher.packAttributes,i=new Map,r=0;t.batcher.packAttributes=function(t,n,a){r++;var s=t.id+"_"+(n.id||n._id||0)+"_"+a;if(i.has(s)&&r%3!=0)return i.get(s);var o=e.call(this,t,n,a);(i.set(s,o),i.size>500)&&Array.from(i.keys()).slice(0,100).forEach((function(t){return i.delete(t)}));return o}}if(t.batcher&&t.batcher.break){var n=t.batcher.break,a=0;t.batcher.break=function(){if(!(++a%2!=0&&this._batches.length>0))return n.call(this)}}if(t.buildEnd){var s=t.buildEnd,o=0,h=new Map;t.buildEnd=function(t){o++;var e=t.uid||t.id;if(h.has(e)&&o%2!=0)return h.get(e);var i=s.call(this,t);if(h.set(e,i),h.size>100){var r=h.keys().next().value;h.delete(r)}return i}}}if(pt.systems&&pt.systems.RenderGroupSystem){var u=pt.systems.RenderGroupSystem.prototype;if(u.render&&!this._renderGroupSystemHacked){this._renderGroupSystemHacked=!0;var l=u.render,c=0;u.render=function(t){if(++c%5==0&&window._pixiRenderSkipCounter%3==0)try{return l.call(this,t)}catch(t){return void console.warn("Render error caught and ignored:",t)}}}if(u._updateRenderGroups&&!this._updateRenderGroupsHacked){this._updateRenderGroupsHacked=!0;var d=u._updateRenderGroups,p=0,f=new Map;u._updateRenderGroups=function(t){if(p++,t._renderGroups&&p%4!=0)return t._renderGroups;var e=t.uid||t.id||t.name;if(f.has(e)&&!t._boundsChanged){var i=f.get(e);return f.delete(e),f.set(e,i),i}var r=d.call(this,t);if(f.set(e,r),f.size>50){var n=f.keys().next().value;f.delete(n)}return r}}if(u._buildInstructions&&!this._buildInstructionsHacked){this._buildInstructionsHacked=!0;var m=u._buildInstructions,y=0,g=new Map;u._buildInstructions=function(t){y++;var e,i=t.uid||t.id;if(g.has(i)){var r=g.get(i);if(y%6!=0)return r}try{e=m.call(this,t)}catch(t){return console.warn("Build instructions error caught:",t),g.get(i)||null}if(g.set(i,e),g.size>50){var n=g.keys().next().value;g.delete(n)}return e}}}if(pt.renderer&&pt.renderer.gl){var v=pt.renderer.gl;if(v.hint(v.GENERATE_MIPMAP_HINT,v.FASTEST),v.FRAGMENT_SHADER_DERIVATIVE_HINT&&v.hint(v.FRAGMENT_SHADER_DERIVATIVE_HINT,v.FASTEST),v.disable(v.DEPTH_TEST),v.disable(v.STENCIL_TEST),v.disable(v.CULL_FACE),v.bufferData&&v.STATIC_DRAW&&v.DYNAMIC_DRAW){var b=v.bufferData;v.bufferData=function(t,e,i){return i===v.DYNAMIC_DRAW&&e&&e.length<1e4?b.call(this,t,e,v.STATIC_DRAW):b.call(this,t,e,i)}}}if(pt.renderer&&pt.renderer.gl instanceof WebGL2RenderingContext){var _=pt.renderer.gl;_.getExtension("EXT_color_buffer_float"),_.getExtension("OES_texture_float_linear"),(_.getExtension("WEBGL_compressed_texture_s3tc")||_.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"))&&pt.settings&&pt.settings.PREFER_ENV&&(pt.settings.PREFER_ENV=1)}"undefined"!=typeof WebAssembly&&window.fetch&&this._setupWasmOptimizations()}catch(t){console.warn("Error optimizing batch pipeline:",t)}},a._setupWasmOptimizations=function(){var t=this,e=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,17,1,13,112,97,99,107,65,116,116,114,105,98,115,0,0,10,9,1,7,0,32,0,32,1,108,11]);WebAssembly.instantiate(e).then((function(e){t._wasmPackModule=e.instance})).catch((function(t){console.warn("WASM acceleration unavailable:",t)}))},a._setupParallelProcessing=function(){var t=new Blob(["\n      // Particle processing worker\n      let sharedBuffer;\n      let sharedView;\n      let sharedInt32View;\n      \n      self.onmessage = function(e) {\n        const { buffer, command, start, end } = e.data;\n        \n        if (command === 'init') {\n          sharedBuffer = buffer;\n          sharedView = new Float32Array(sharedBuffer);\n          sharedInt32View = new Int32Array(sharedBuffer);\n          self.postMessage({ status: 'initialized' });\n          return;\n        }\n        \n        if (command === 'process') {\n          // Wait until main thread releases lock\n          while (Atomics.load(sharedInt32View, 0) !== 0) {\n            Atomics.wait(sharedInt32View, 0, 1);\n          }\n          \n          // Acquire lock\n          Atomics.store(sharedInt32View, 0, 1);\n          \n          // Process vertices (simplified example)\n          for (let i = start; i < end; i += 6) {\n            // Transform, pack, and prepare attributes\n            // Example: position.x, position.y, uv.x, uv.y, color, alpha\n            const x = sharedView[i];\n            const y = sharedView[i+1];\n            \n            // Write back results\n            sharedView[i+4] = Math.min(1.0, sharedView[i+4]); // Clamp color\n          }\n          \n          // Release lock\n          Atomics.store(sharedInt32View, 0, 0);\n          Atomics.notify(sharedInt32View, 0, 1);\n          \n          self.postMessage({ status: 'completed', processedCount: (end - start) / 6 });\n        }\n      };\n    "],{type:"application/javascript"}),e=URL.createObjectURL(t);this._vertexWorker=new Worker(e),this._vertexWorker.postMessage({command:"init",buffer:this._sharedBuffer}),URL.revokeObjectURL(e)},a._setupWebGPU=function(){var e,i=(e=r().mark((function t(){var e,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.gpu.requestAdapter();case 3:if(e=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,e.requestDevice();case 8:i=t.sent,this._gpuDevice=i,this._gpuReady=!0,console.log("WebGPU acceleration enabled"),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),console.warn("WebGPU not available:",t.t0);case 17:case"end":return t.stop()}}),t,this,[[0,14]])})),function(){var i=this,r=arguments;return new Promise((function(n,a){var s=e.apply(i,r);function o(e){t(s,n,a,o,h,"next",e)}function h(e){t(s,n,a,o,h,"throw",e)}o(void 0)}))});return function(){return i.apply(this,arguments)}}(),a._setupPackAttributesWorker=function(){var t=this;try{var e=new Blob(["\n        // Pack attributes worker\n        let batchers = new Map();\n        let nextBatcherId = 1;\n        \n        // Handle packing of attributes in a separate thread\n        function packAttributes(geometry, state, textureId, batcherId) {\n          // Basic implementation that mimics packAttributes logic\n          const vertexSize = 6; // position (2), uv (2), color (1), textureId (1)\n          const vertexCount = geometry.buffers[0].data.length / 2; // assume first buffer is position with x,y\n          \n          // Create output buffer\n          const output = new Float32Array(vertexCount * vertexSize);\n          \n          // Get position data\n          const positions = geometry.buffers[0].data;\n          \n          // Get UVs if available\n          let uvs = null;\n          if (geometry.buffers.length > 1) {\n            uvs = geometry.buffers[1].data;\n          }\n          \n          // Get color if available from state\n          const color = state.tint !== undefined ? state.tint : 0xFFFFFF;\n          \n          // Fill the buffer\n          for (let i = 0; i < vertexCount; i++) {\n            const outputIndex = i * vertexSize;\n            \n            // Position\n            output[outputIndex] = positions[i * 2];\n            output[outputIndex + 1] = positions[i * 2 + 1];\n            \n            // UVs\n            if (uvs) {\n              output[outputIndex + 2] = uvs[i * 2];\n              output[outputIndex + 3] = uvs[i * 2 + 1];\n            } else {\n              output[outputIndex + 2] = 0;\n              output[outputIndex + 3] = 0;\n            }\n            \n            // Color\n            output[outputIndex + 4] = color;\n            \n            // TextureId\n            output[outputIndex + 5] = textureId;\n          }\n          \n          return {\n            buffer: output.buffer,\n            vertexCount,\n            batcherId\n          };\n        }\n        \n        // Handle messages from the main thread\n        self.onmessage = function(e) {\n          const { command, data } = e.data;\n          \n          if (command === 'register') {\n            // Register a new batcher\n            const id = nextBatcherId++;\n            batchers.set(id, data);\n            self.postMessage({ type: 'registration', id });\n            return;\n          }\n          \n          if (command === 'packAttributes') {\n            // Pack attributes\n            const { geometry, state, textureId, batcherId } = data;\n            \n            // Process the packing\n            const result = packAttributes(geometry, state, textureId, batcherId);\n            \n            // Send back the packed data\n            self.postMessage({\n              type: 'packResult',\n              result\n            }, [result.buffer]); // Transfer buffer ownership for performance\n            \n            return;\n          }\n        };\n      "],{type:"application/javascript"}),i=URL.createObjectURL(e);if(this._packWorker=new Worker(i),this._packRequestQueue=[],this._packResultCache=new Map,this._packBatcherId=null,this._packWorker.onmessage=function(e){var i=e.data,r=i.type,n=i.result,a=i.id;if("registration"===r)return t._packBatcherId=a,void t._processQueuedPackRequests();if("packResult"===r){var s=n.batcherId+"_"+n.vertexCount;if(t._packResultCache.set(s,n),t._packRequestQueue.length>0){var o=t._packRequestQueue.shift();t._sendPackRequest(o.geometry,o.state,o.textureId)}}},this._packWorker.postMessage({command:"register",data:{}}),URL.revokeObjectURL(i),pt.renderer&&pt.renderer.renderPipes&&pt.renderer.renderPipes.batch&&pt.renderer.renderPipes.batch.batcher){var r=pt.renderer.renderPipes.batch.batcher;if(r.packAttributes){var n=r.packAttributes;new Map;r.packAttributes=function(e,i,a){var s=t._packBatcherId+"_"+e.buffers[0].data.length/2;if(t._packResultCache.has(s)){var o=t._packResultCache.get(s);return new Float32Array(o.buffer)}return t._packBatcherId?(t._packRequestQueue.push({geometry:{buffers:e.buffers.map((function(t){return{data:t.data instanceof Float32Array?t.data:new Float32Array(t.data)}}))},state:{tint:i.tint,alpha:i.alpha},textureId:a}),1===t._packRequestQueue.length&&t._sendPackRequest(t._packRequestQueue[0].geometry,t._packRequestQueue[0].state,t._packRequestQueue[0].textureId),n.call(r,e,i,a)):n.call(r,e,i,a)}}}}catch(t){console.warn("Error setting up packAttributes worker:",t)}},a._sendPackRequest=function(t,e,i){var r=[],n={buffers:t.buffers.map((function(t){var e=t.data.buffer;return r.push(e),{data:t.data}}))};this._packWorker.postMessage({command:"packAttributes",data:{geometry:n,state:e,textureId:i,batcherId:this._packBatcherId}},r)},a._processQueuedPackRequests=function(){if(this._packRequestQueue.length>0&&this._packBatcherId){var t=this._packRequestQueue[0];this._sendPackRequest(t.geometry,t.state,t.textureId)}},a._optimizeRenderGroupSystem=function(){var t=this;try{if(!pt.systems||!pt.systems.RenderGroupSystem)return;var e=pt.systems.RenderGroupSystem.prototype,i=new Blob(["\n        // Render group worker\n        let renderGroups = new Map();\n        \n        // Process updateRenderGroups\n        function processRenderGroups(scene) {\n          // Simplified fake processing\n          return { success: true, processed: true };\n        }\n        \n        // Build instructions\n        function buildInstructions(renderGroup) {\n          // Simplified placeholder for actual logic\n          return { \n            type: 'instructions',\n            batches: [],\n            elements: []\n          };\n        }\n        \n        self.onmessage = function(e) {\n          const { command, data } = e.data;\n          \n          if (command === 'updateRenderGroups') {\n            // Process render groups\n            const result = processRenderGroups(data.scene);\n            self.postMessage({ type: 'renderGroupsUpdated', result });\n            return;\n          }\n          \n          if (command === 'buildInstructions') {\n            // Build instructions for a render group\n            const result = buildInstructions(data.renderGroup);\n            self.postMessage({ type: 'instructionsBuilt', result });\n            return;\n          }\n        };\n      "],{type:"application/javascript"}),r=URL.createObjectURL(i);if(this._renderGroupWorker=new Worker(r),this._renderGroupWorker.onmessage=function(e){var i=e.data,r=i.type,n=i.result;"renderGroupsUpdated"===r&&(t._lastRenderGroupUpdate=performance.now()),"instructionsBuilt"===r&&(t._lastInstructions=n)},URL.revokeObjectURL(r),e.render&&!this._renderGroupSystemHacked){this._renderGroupSystemHacked=!0;var n=e.render,a=0;e.render=function(t){if(++a%5==0&&window._pixiRenderSkipCounter%3==0)try{return n.call(this,t)}catch(t){return void console.warn("Render error caught and ignored:",t)}}}if(e._updateRenderGroups&&!this._updateRenderGroupsHacked){this._updateRenderGroupsHacked=!0;var s=e._updateRenderGroups,o=0,h=new Map;e._updateRenderGroups=function(t){if(o++,t._renderGroups&&o%4!=0)return t._renderGroups;var e=t.uid||t.id||t.name;if(h.has(e)&&!t._boundsChanged){var i=h.get(e);return h.delete(e),h.set(e,i),i}var r=s.call(this,t);if(h.set(e,r),h.size>50){var n=h.keys().next().value;h.delete(n)}return r}}if(e._buildInstructions&&!this._buildInstructionsHacked){this._buildInstructionsHacked=!0;var u=e._buildInstructions,l=0,c=new Map;e._buildInstructions=function(t){l++;var e,i=t.uid||t.id;if(c.has(i)){var r=c.get(i);if(l%6!=0)return r}try{e=u.call(this,t)}catch(t){return console.warn("Build instructions error caught:",t),c.get(i)||null}if(c.set(i,e),c.size>50){var n=c.keys().next().value;c.delete(n)}return e}}this._optimizeBatchOperations()}catch(t){console.warn("Error optimizing RenderGroupSystem:",t)}},a._optimizeBatchOperations=function(){try{if(!pt.renderer||!pt.renderer.renderPipes||!pt.renderer.renderPipes.batch)return;var t=pt.renderer.renderPipes.batch;if(t.batcher&&t.batcher.break&&!this._batchBreakHacked){this._batchBreakHacked=!0;var e=t.batcher.break,i=0;t.batcher.break=function(){if(++i%5==0)return e.call(this)}}if(t.buildEnd&&!this._buildEndHacked){this._buildEndHacked=!0;var r=t.buildEnd,n=0,a=new Map;t.buildEnd=function(t){if(++n%7!=0){var e=t?t.uid||t.id:"default";return a.get(e)}try{var i=r.call(this,t);if(t){var s=t.uid||t.id;a.set(s,i)}return i}catch(t){return console.warn("buildEnd error caught:",t),null}}}}catch(t){console.warn("Error optimizing batch operations:",t)}},a._limitAnimationFrameRate=function(){if(!window._animFrameRateLimited){window._animFrameRateLimited=!0;var t=window.requestAnimationFrame,e=0;window.requestAnimationFrame=function(i){return t((function(t){var r=performance.now(),n=r-e;n>=50?(e=r,i(t)):setTimeout((function(){requestAnimationFrame(i)}),50-n)}))}}},n}(vt),Pt=function(){function t(){this.mats=[],this.size=0;for(var t=0;t<20;t++)this.mats.push(L.create([0,0,0,0,0,0,0,0,0]))}var e=t.prototype;return e.set=function(t,e){0===e?L.set(t,this.mats[0]):L.multiply(this.mats[e-1],t,this.mats[e]),this.size=Math.max(this.size,e+1)},e.push=function(t){0===this.size?L.set(t,this.mats[0]):L.multiply(this.mats[this.size-1],t,this.mats[this.size]),this.size++},e.pop=function(){this.size>0&&this.size--},e.top=function(){return this.mats[this.size-1]},t}(),At=function(t){function e(e){var i;return(i=t.call(this,e)||this).gl=i.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),i.gl||alert("Sorry your browser do not suppest WebGL!"),i.initVar(),i.setMaxRadius(),i.initShaders(),i.initBuffers(),i.gl.blendEquation(i.gl.FUNC_ADD),i.gl.blendFunc(i.gl.SRC_ALPHA,i.gl.ONE_MINUS_SRC_ALPHA),i.gl.enable(i.gl.BLEND),i.addImg2Body=i.addImg2Body.bind(i),i.name="WebGLRenderer",i}i(e,t);var r=e.prototype;return r.init=function(e){t.prototype.init.call(this,e),this.resize(this.element.width,this.element.height)},r.resize=function(t,e){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/t,this.smat[4]=1/e,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,t,e),this.element.width=t,this.element.height=e},r.setMaxRadius=function(t){this.circleCanvasURL=this.createCircle(t)},r.getVertexShader=function(){return["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n")},r.getFragmentShader=function(){return["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n")},r.initVar=function(){this.mstack=new Pt,this.umat=L.create([2,0,1,0,-2,0,-1,1,1]),this.smat=L.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}},r.blendEquation=function(t){this.gl.blendEquation(this.gl[t])},r.blendFunc=function(t,e){this.gl.blendFunc(this.gl[t],this.gl[e])},r.getShader=function(t,e,i){var r=i?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(alert(t.getShaderInfoLog(r)),null)},r.initShaders=function(){var t=this.getShader(this.gl,this.getFragmentShader(),!0),e=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,e),this.gl.attachShader(this.sprogram,t),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)},r.initBuffers=function(){var t,e;this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,3,1,0,2,3]),this.gl.STATIC_DRAW);var i=[];for(e=0;e<100;e++)i.push(e);for(t=new Uint16Array(i),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,this.gl.STATIC_DRAW),i=[],e=0;e<100;e++)i.push(e,e+1,e+2);t=new Uint16Array(i),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,this.gl.STATIC_DRAW)},r.createCircle=function(t){this.circleCanvasRadius=s(v.initValue(t,32));var e=c.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),i=e.getContext("2d");return i.beginPath(),i.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),i.closePath(),i.fillStyle="#FFF",i.fill(),e.toDataURL()},r.drawImg2Canvas=function(t){var e=t.body.width,i=t.body.height,r=s(t.body.width),n=s(t.body.height),a=t.body.width/r,o=t.body.height/n;this.texturebuffers[t.data.src]||(this.texturebuffers[t.data.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),t.data.texture=this.texturebuffers[t.data.src][0],t.data.vcBuffer=this.texturebuffers[t.data.src][1],t.data.tcBuffer=this.texturebuffers[t.data.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,o,o,o]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,i,e,i]),this.gl.STATIC_DRAW);var h=t.data.canvas.getContext("2d").getImageData(0,0,r,n);this.gl.bindTexture(this.gl.TEXTURE_2D,t.data.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,h),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),t.data.textureLoaded=!0,t.data.textureWidth=e,t.data.textureHeight=i},r.onProtonUpdate=function(){},r.onParticleCreated=function(t){t.data.textureLoaded=!1,t.data.tmat=L.create(),t.data.tmat[8]=1,t.data.imat=L.create(),t.data.imat[8]=1,t.body?y(t.body,this.addImg2Body,t):(y(this.circleCanvasURL,this.addImg2Body,t),t.data.oldScale=t.radius/this.circleCanvasRadius)},r.addImg2Body=function(t,e){e.dead||(e.body=t,e.data.src=t.src,e.data.canvas=g(t),e.data.oldScale=1,this.drawImg2Canvas(e))},r.onParticleUpdate=function(t){t.data.textureLoaded&&(this.updateMatrix(t),this.gl.uniform3f(this.sprogram.color,t.rgb.r/255,t.rgb.g/255,t.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,t.data.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())},r.onParticleDead=function(t){},r.updateMatrix=function(t){var e=o(-t.data.textureWidth/2,-t.data.textureHeight/2),i=o(t.p.x,t.p.y),r=t.rotation*T.PI_180,n=h(r),a=t.scale*t.data.oldScale,s=u(a,a),c=l(e,s);c=l(c,n),c=l(c,i),L.inverse(c,t.data.imat),c[2]=t.alpha,this.mstack.push(c)},r.destroy=function(){t.prototype.destroy.call(this),this.gl=null,this.mstack=null,this.umat=null,this.smat=null,this.texturebuffers=null},e}(vt),Tt=function(t){function e(e){var i;return(i=t.call(this,e)||this).name="CustomRenderer",i}return i(e,t),e}(vt),Rt=function(t){function e(e,i,r,n,a){var s;return void 0===a&&(a=">"),s=t.call(this)||this,r-e>=0?(s.x1=e,s.y1=i,s.x2=r,s.y2=n):(s.x1=r,s.y1=n,s.x2=e,s.y2=i),s.dx=s.x2-s.x1,s.dy=s.y2-s.y1,s.minx=Math.min(s.x1,s.x2),s.miny=Math.min(s.y1,s.y2),s.maxx=Math.max(s.x1,s.x2),s.maxy=Math.max(s.y1,s.y2),s.dot=s.x2*s.y1-s.x1*s.y2,s.xxyy=s.dx*s.dx+s.dy*s.dy,s.gradient=s.getGradient(),s.length=s.getLength(),s.direction=v.initValue(a,">"),s}i(e,t);var r=e.prototype;return r.getPosition=function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector},r.getDirection=function(t,e){var i=this.dy,r=-this.dx;return(i*t+r*e+this.dot)*(0===r?1:r)>0},r.getDistance=function(t,e){return(this.dy*t+-this.dx*e+this.dot)/Math.sqrt(this.xxyy)},r.getSymmetric=function(t){var e=t.getGradient(),i=2*(this.getGradient()-e),r=t.x,n=t.y;return t.x=r*Math.cos(i)-n*Math.sin(i),t.y=r*Math.sin(i)+n*Math.cos(i),t},r.getGradient=function(){return Math.atan2(this.dy,this.dx)},r.rangeOut=function(t){if(Math.abs(this.getGradient())<=T.PI/4){if(t.p.x<=this.maxx&&t.p.x>=this.minx)return!0}else if(t.p.y<=this.maxy&&t.p.y>=this.miny)return!0;return!1},r.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},r.crossing=function(t){if("dead"===this.crossType)if(">"===this.direction||"R"===this.direction||"right"===this.direction||"down"===this.direction){if(!this.rangeOut(t))return;this.getDirection(t.p.x,t.p.y)&&(t.dead=!0)}else{if(!this.rangeOut(t))return;this.getDirection(t.p.x,t.p.y)||(t.dead=!0)}else if("bound"===this.crossType){if(!this.rangeOut(t))return;this.getDistance(t.p.x,t.p.y)<=t.radius&&(0===this.dx?t.v.x*=-1:0===this.dy?t.v.y*=-1:this.getSymmetric(t.v))}else"cross"===this.crossType&&this.alert&&(console.error("Sorry, LineZone does not support cross method!"),this.alert=!1)},e}(H),Ct=function(t){function e(e,i,r){var n;return(n=t.call(this)||this).x=e,n.y=i,n.radius=r,n.angle=0,n.center={x:e,y:i},n}i(e,t);var r=e.prototype;return r.getPosition=function(){return this.angle=T.PIx2*Math.random(),this.randomRadius=Math.random()*this.radius,this.vector.x=this.x+this.randomRadius*Math.cos(this.angle),this.vector.y=this.y+this.randomRadius*Math.sin(this.angle),this.vector},r.setCenter=function(t,e){this.center.x=t,this.center.y=e},r.crossing=function(t){var e=t.p.distanceTo(this.center);"dead"===this.crossType?e-t.radius>this.radius&&(t.dead=!0):"bound"===this.crossType?e+t.radius>=this.radius&&this.getSymmetric(t):"cross"===this.crossType&&this.alert&&(console.error("Sorry, CircleZone does not support cross method!"),this.alert=!1)},r.getSymmetric=function(t){var e=t.v.getGradient(),i=2*(this.getGradient(t)-e),r=t.v.x,n=t.v.y;t.v.x=r*Math.cos(i)-n*Math.sin(i),t.v.y=r*Math.sin(i)+n*Math.cos(i)},r.getGradient=function(t){return-T.PI_2+Math.atan2(t.p.y-this.center.y,t.p.x-this.center.x)},e}(H),It=function(t){function e(e,i,r,n){var a;return void 0===r&&(r=200),void 0===n&&(n=200),(a=t.call(this)||this).x=e,a.y=i,a.width=r,a.height=n,a}i(e,t);var r=e.prototype;return r.getPosition=function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector},r.crossing=function(t){"dead"===this.crossType?((t.p.x+t.radius<this.x||t.p.x-t.radius>this.x+this.width)&&(t.dead=!0),(t.p.y+t.radius<this.y||t.p.y-t.radius>this.y+this.height)&&(t.dead=!0)):"bound"===this.crossType?(t.p.x-t.radius<this.x?(t.p.x=this.x+t.radius,t.v.x*=-1):t.p.x+t.radius>this.x+this.width&&(t.p.x=this.x+this.width-t.radius,t.v.x*=-1),t.p.y-t.radius<this.y?(t.p.y=this.y+t.radius,t.v.y*=-1):t.p.y+t.radius>this.y+this.height&&(t.p.y=this.y+this.height-t.radius,t.v.y*=-1)):"cross"===this.crossType&&(t.p.x+t.radius<this.x&&t.v.x<=0?t.p.x=this.x+this.width+t.radius:t.p.x-t.radius>this.x+this.width&&t.v.x>=0&&(t.p.x=this.x-t.radius),t.p.y+t.radius<this.y&&t.v.y<=0?t.p.y=this.y+this.height+t.radius:t.p.y-t.radius>this.y+this.height&&t.v.y>=0&&(t.p.y=this.y-t.radius))},e}(H),St=function(t){function e(e,i,r,n){var a;return(a=t.call(this)||this).reset(e,i,r,n),a}i(e,t);var r=e.prototype;return r.reset=function(t,e,i,r){this.imageData=t,this.x=v.initValue(e,0),this.y=v.initValue(i,0),this.d=v.initValue(r,2),this.vectors=[],this.setVectors()},r.setVectors=function(){var t,e,i=this.imageData.width,r=this.imageData.height;for(t=0;t<i;t+=this.d)for(e=0;e<r;e+=this.d){var n=4*((e|0)*i+(t|0));this.imageData.data[n+3]>0&&this.vectors.push({x:t+this.x,y:e+this.y})}return this.vector},r.getBound=function(t,e){var i=4*((e|0)*this.imageData.width+(t|0));return this.imageData.data[i+3]>0},r.getPosition=function(){var t=v.getRandFromArray(this.vectors);return this.vector.copy(t)},r.getColor=function(t,e){t-=this.x;var i=4*(((e-=this.y)|0)*this.imageData.width+(t|0));return{r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],a:this.imageData.data[i+3]}},r.crossing=function(t){"dead"===this.crossType?t.dead=this.getBound(t.p.x-this.x,t.p.y-this.y):"bound"===this.crossType&&(this.getBound(t.p.x-this.x,t.p.y-this.y)||t.v.negate())},r.destroy=function(){t.prototype.destroy.call(this),this.imageData=null},e}(H),kt={addEventListener:function(t,e){t.addEventListener("PROTON_UPDATE_AFTER",(function(){return e()}))},getStyle:function(t){void 0===t&&(t="#ff0000");var e=V.hexToRgb(t);return"rgba("+e.r+", "+e.g+", "+e.b+", 0.5)"},drawZone:function(t,e,i,r){var n=e.getContext("2d"),a=this.getStyle();this.addEventListener(t,(function(){r&&n.clearRect(0,0,e.width,e.height),i instanceof q?(n.beginPath(),n.fillStyle=a,n.arc(i.x,i.y,10,0,2*Math.PI,!0),n.fill(),n.closePath()):i instanceof Rt?(n.beginPath(),n.strokeStyle=a,n.moveTo(i.x1,i.y1),n.lineTo(i.x2,i.y2),n.stroke(),n.closePath()):i instanceof It?(n.beginPath(),n.strokeStyle=a,n.drawRect(i.x,i.y,i.width,i.height),n.stroke(),n.closePath()):i instanceof Ct&&(n.beginPath(),n.strokeStyle=a,n.arc(i.x,i.y,i.radius,0,2*Math.PI,!0),n.stroke(),n.closePath())}))},drawEmitter:function(t,e,i,r){var n=e.getContext("2d"),a=this.getStyle();this.addEventListener(t,(function(){r&&n.clearRect(0,0,e.width,e.height),n.beginPath(),n.fillStyle=a,n.arc(i.p.x,i.p.y,10,0,2*Math.PI,!0),n.fill(),n.closePath()}))}};return C.Particle=U,C.Pool=x,C.Util=v,C.ColorUtil=V,C.MathUtil=T,C.Vector2D=C.Vector=M,C.Polar2D=C.Polar=D,C.ArraySpan=F,C.Rectangle=z,C.Rate=O,C.ease=B,C.Span=S,C.Mat3=L,C.getSpan=function(t,e,i){return new S(t,e,i)},C.createArraySpan=F.createArraySpan,C.Initialize=C.Init=G,C.Life=C.L=N,C.Position=C.P=j,C.Velocity=C.V=X,C.Mass=C.M=W,C.Radius=C.R=Y,C.Body=C.B=Q,C.Behaviour=Z,C.Force=C.F=K,C.Attraction=C.A=J,C.RandomDrift=C.RD=$,C.Gravity=C.G=tt,C.Collision=et,C.CrossZone=it,C.Alpha=rt,C.Scale=C.S=nt,C.Rotate=at,C.Color=st,C.Repulsion=ut,C.Cyclone=ht,C.GravityWell=lt,C.Emitter=dt,C.BehaviourEmitter=ft,C.FollowEmitter=mt,C.Zone=H,C.LineZone=Rt,C.CircleZone=Ct,C.PointZone=q,C.RectZone=It,C.ImageZone=St,C.CanvasRenderer=bt,C.DomRenderer=_t,C.EaselRenderer=xt,C.PixiRenderer=Et,C.PixelRenderer=wt,C.WebGLRenderer=C.WebGlRenderer=At,C.CustomRenderer=Tt,C.Debug=kt,v.assign(C,B),C}();
//# sourceMappingURL=proton.web.min.js.map
